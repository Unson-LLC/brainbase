# SNS投稿（ドラフト作成 → 画像生成 → X投稿）

ユーザーの入力（ネタ/アイデア/今日の作業）から、X投稿のドラフトを2-3案作成し、選択した案で画像生成→投稿まで実行。

## 参照すべきファイル

作成前に必ず以下を読み込んでください：
1. `_codex/sns/sns_strategy_os.md` - 戦略・ポジショニング
2. `_codex/sns/rules.md` - ガードレール
3. `_codex/sns/x_account_profile.md` - アカウント情報・人格定義
4. `_codex/sns/post_log.md` - 投稿履歴（ネタ被り防止用）

## アカウント軸

- **肩書き**: 事業OSエンジニア
- **テーマ**: 複数事業を同じOS（構造・KPI）で回す設計図を公開
- **ターゲット**: GM候補 / 経営者 / 事業責任者
- **KPI**: DM・商談・採用（フォロワー数より重要）

## ガードレール（必須）

- ❌ 禁止: ツール感想だけ / 一般論だけ / 事業OSと無関係なAIニュース
- ✅ 「OSのどこが変わるか」を最低1行入れる
- ✅ **「悩み→判断→結果」型を必ず1案は出す**（何に悩み、なぜその判断をし、どうなったか）
- ✅ 問いかけCTAで締める（「〜な人いる？」「みんなはどうしてる？」など）
- ❌ DM誘導は避ける（ハードルが高い）
- ✅ トーン: 簡潔・具体・再現性。誇張NG、数字は根拠付き

## imp伸ばしの構造（1万imp狙い）

**必ずこの構造で作成する：**
```
【フック】← 常識破壊。「続きを読む」を押させる
--------（続きを読む）--------
【本文】← 悩み→判断→結果
【CTA】← 問いかけで締める
```

**フックの鉄則：**
- 長文にする（続きを読むが出る長さ）
- 常識破壊を1行目に入れる
- フック例：「本当は内緒だけど」「暴露するけど」「実は〜」「〜はやめた方がいい」「みんな〜してるけど間違ってる」

**投稿後：3分はアクティブを保つ**（リプ返、いいね等）

## 出力フォーマット

各案を以下の形式で出力：

```
━━━━━━━━━━━━━━━━━━━━
📝 案1（フックの型）
━━━━━━━━━━━━━━━━━━━━

【フック】
（常識破壊の1行。「続きを読む」を押させる）

【本文】
（悩み→判断→結果。長文で「続きを読む」が出る長さに）

【CTA】
（問いかけで締める）

【テンプレ】infographic / exploded / dashboard / framework

━━━━━━━━━━━━━━━━━━━━
```

**フックのパターン（詳細は `_codex/sns/rules.md` 参照）：**
- **常識破壊系**: 「本当は内緒だけど」「暴露するけど」「実は〜」
- **禁止・警告系**: 「〜な人は読まないで」「〜だけは絶対やるな」
- **意外性系**: 「〜したら〇〇になった」「〇〇日で〜できた方法」
- **数字系**: 「〇〇%が知らない」「たった〇〇で」
- **ストーリー系**: 「〜で失敗→〜で逆転」

## 実行フロー

### Step 1: ネタ選定（ユーザー入力がない場合）

**ユーザーがネタを指定していない場合、必ずこのステップを実行する。**

**1-0. 下書きストックの確認**
- `_codex/sns/drafts/today_ideas.md` を読み込む
- 下書きがある場合は「下書きに○件ストックがあります」と報告
- 下書きのタグと現在の投稿可否を判定し、投稿可能な下書きを優先候補として提案

**1-1. コミット収集**
```bash
# 過去3日分のコミットを取得
cd /Users/ksato/workspace && git log --oneline --since="3 days ago" | head -20
```

**1-2. タグベース被りチェック**
- `_codex/sns/post_log.md` を読み込む
- 各タグの「最短間隔」と最終投稿日を確認
- **被り判定基準**:
  - 同じタグの投稿が「最短間隔」以内 → ❌ 被り（除外）
  - 複数タグがある場合は全てチェック
- 判定結果を候補提案時に明示（例: `#人脈: 12/3投稿済み → ❌ 5日空けが必要`）

**1-3. 戦略フィルタリング**
`_codex/sns/sns_strategy_os.md` を参照し、以下の観点でネタを評価：

| 評価軸 | チェック |
|--------|---------|
| プロセスエコノミー | 「過程」が見えるか？失敗・試行錯誤があるか？ |
| ワンチャン感 | 挑戦的だが不可能ではない目標か？ |
| 誤解→共感→回収 | 「事件化」できるか？常識破壊フックが作れるか？ |
| 事業OS関連 | 「OSのどこが変わるか」が説明できるか？ |

**1-4. ネタ候補を3つ提案**

```
━━━━━━━━━━━━━━━━━━━━
🎯 ネタ候補
━━━━━━━━━━━━━━━━━━━━

【候補1】コミットID: xxxxx
トピック: ○○○
タグ: `#タグ名` → ✅ 投稿可（前回: 12/1、間隔: 5日）
なぜ良いか: △△△（戦略との整合性）
想定フック: 「□□□」

【候補2】コミットID: xxxxx
トピック: ○○○
タグ: `#タグ名` → ✅/❌ 判定と理由
なぜ良いか: △△△
想定フック: 「□□□」

【候補3】コミットID: xxxxx
トピック: ○○○
タグ: `#タグ名` → ✅/❌ 判定と理由
なぜ良いか: △△△
想定フック: 「□□□」

━━━━━━━━━━━━━━━━━━━━
```

**⚠️ 注意**: タグ被りで❌になっているネタは除外し、✅のネタのみを候補として提案すること。

**1-5. ネタ選択**
AskUserQuestionで選択を求める：
- 下書きから選択（下書きがある場合のみ表示）
- 候補1で作成
- 候補2で作成
- 候補3で作成
- 別のネタを指定

**ユーザーがネタを指定している場合は、このステップをスキップしてStep 2へ。**

### Step 2: ドラフト作成
1. **「悩み→判断→結果」型を必ず1案は含める**
   - gitコミットメッセージの「悩み→判断:」セクションから抽出（優先）
   - コミットに記録がない場合のみ、会話の文脈から推測
   - それでも不明な場合のみユーザーにヒアリング（基本はしない）
2. 「OSのどこが変わるか」の視点で再構成
3. 人格定義に従った口調・表現で作成（「〜なんよな」「マジで」等）
4. ガードレールをチェックしながら2-3案作成
5. 各案に【テンプレ】を指定（infographic / exploded / dashboard / framework）

### Step 3: ユーザー選択
案を提示したら、AskUserQuestionで選択を求める：

```
どの案で投稿しますか？
- 案1で投稿
- 案2で投稿
- 案3で投稿
- 修正したい
- 投稿しない（ドラフト保存のみ）
```

### Step 4: 画像生成
選択された案の【テンプレ】を使ってNano Banana Proで画像生成：

```bash
# テンプレート一覧確認
/Users/ksato/workspace/.venv/bin/python /Users/ksato/workspace/_codex/common/ops/scripts/nano_banana.py --list

# 画像生成（本文から自動でポイント抽出）
/Users/ksato/workspace/.venv/bin/python /Users/ksato/workspace/_codex/common/ops/scripts/nano_banana.py \
  -t <template> \
  "トピック" \
  "ポイント1" "ポイント2" "ポイント3"
```

テンプレート：

**従来型（情報整理向け）:**
- `infographic` - ビジネス図解（ポイント整理向け）
- `exploded` - 3D分解図（システム構造向け）
- `dashboard` - ダッシュボード（KPI向け）
- `framework` - 概念図（フレームワーク向け）

**ど素人ホテル流（感情・プロセス向け）:**
- `progress` - 進捗/Before-After（プロセスエコノミー用）
- `incident` - 事件風サムネ（感情トリガー用）
- `poll` - 投票/アンケート（参加型用）
- `recovery` - V字回復ストーリー（失敗→回復用）

### Step 5: 投稿前チェック（必須）

**必ず `tweet_preview.py` を実行してチェックする。**

```bash
# 見切れシミュレーション実行（投稿本文をパイプで渡す）
echo '投稿本文' | python3 /Users/ksato/workspace/_codex/common/ops/scripts/tweet_preview.py
```

**自動チェック内容：**
- 140文字で区切り、見える部分/隠れる部分を表示
- 「結論」「つまり」「要するに」「学び」「ポイント」等のオチキーワードが見える位置にないか検出
- 問題あり → ❌ NG（exit code 1）
- 問題なし → ✅ OK（exit code 0）

**❌ NG の場合：**
- フック部分を長くしてオチを押し下げる
- 本文構成を変更（フック→詳細→結論の順に）
- 修正後、再度 `tweet_preview.py` を実行

**✅ OK の場合のみ投稿実行へ進む**

### Step 6: 投稿実行

```bash
/Users/ksato/workspace/.venv/bin/python /Users/ksato/workspace/_codex/common/ops/scripts/sns_post.py \
  --title "トピック要約" \
  --body "投稿本文" \
  --image <生成された画像パス>
```

投稿完了後：
1. URLを報告
2. `post_log.md` に自動記録される

## オプション

| 引数 | 動作 |
|------|------|
| `--draft-only` | ドラフト作成のみ（投稿しない） |
| `--skip-image` | 画像生成をスキップ |
| `--image PATH` | 既存画像を使用 |

## 入力例

- `/sns` → 今日のコミットからネタ抽出
- `/sns BAAOを3分割した` → 指定ネタで案作成
- `/sns --draft-only` → ドラフト保存のみ
- `/sns --image /path/to/img.png` → 既存画像で投稿

$ARGUMENTS
