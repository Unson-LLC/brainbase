# バグ修正ワークフロー（BUG-XXX）

バグを追跡可能な形で修正します。SalesTailorの根本原因分析システムを適用。

## 引数
$ARGUMENTS: バグID（例: BUG-036）と概要

## 実行手順

### 1. バグIDの採番
```bash
git log --oneline | grep -oE "BUG-[0-9]+" | sort -u | tail -5
```

### 2. 原因分析
修正前に以下を明確にする:
- **現象**: 何が起きているか
- **原因**: なぜ起きているか
- **影響範囲**: どこに影響があるか
- **修正方針**: どう直すか

### 3. ブランチ作成
```bash
git checkout -b bugfix/BUG-XXX-<概要>
```

### 4. 修正 → コミット
```
fix(scope): <修正内容>（BUG-XXX）

現象:
- 何が起きていたか

原因:
- なぜ起きていたか

修正:
- どう直したか

BUG-XXX
```

## SalesTailor流のバグ修正コミット例

```
fix: formSubmissionWorker の LLMGateway 初期化順序を修正（BUG-042）

現象:
- ワーカー起動時にLLMGatewayの初期化エラーが発生

原因:
- 環境変数の読み込み前にLLMGatewayが初期化されていた

修正:
- dotenvの読み込みを最初に移動
- LLMGatewayの初期化を遅延評価に変更

BUG-042
```

## 根本原因分析（5 Whys）

複雑なバグは「なぜ？」を5回繰り返す:

1. なぜエラーが出た？ → 初期化に失敗した
2. なぜ初期化に失敗した？ → 環境変数が読めなかった
3. なぜ環境変数が読めなかった？ → dotenvの前に実行された
4. なぜdotenvの前に実行された？ → モジュール読み込み順序の問題
5. なぜ順序の問題が起きた？ → 依存関係が明示されていなかった

→ **根本原因**: 依存関係の明示不足
→ **再発防止**: 初期化順序をドキュメント化

## 再発防止チェック

- [ ] 根本原因を特定したか
- [ ] 同様のバグが他にないか確認したか
- [ ] テストを追加したか
- [ ] ドキュメントを更新したか（必要な場合）
