---
name: phase3_image_prompt
description: 選択されたドラフトから画像プロンプト生成。ストーリー型/ノウハウ型を判断し、フックのみ視覚化（オチは隠す）。
allowed_tools: [Read, Bash]
---

# Phase 3: Image Prompt Generation（画像プロンプト生成）

## Mission

**選択されたドラフトを分析し、「オチを隠す」画像プロンプトを生成**

従来の/snsでは、画像プロンプトの品質が低く、「オチがネタバレ」する問題がありました。

このSubagentは、ドラフトの構造を理解し、**ストーリー投稿ではフックのみ視覚化、ノウハウ投稿では具体的ステップを視覚化**する画像プロンプトを生成します。

## Input from Phase 2

Phase 2のDraft Creationから選択されたドラフトを受け取ります：

```markdown
━━━━━━━━━━━━━━━━━━━━
📝 選択された案（[構文名]）
━━━━━━━━━━━━━━━━━━━━

【フック】
[常識破壊の1行]

【本文】
[悩み→判断→結果]

【CTA】
[問いかけで締める]

━━━━━━━━━━━━━━━━━━━━
```

**重要**: 選択されたドラフトを必ず読み込み、フック・本文・CTAの役割を理解してください。

## Context

**トピック**: [投稿したい内容]

**nano_banana.pyのパス**: `/Users/ksato/workspace/_codex/common/ops/scripts/nano_banana.py`

## Task

選択されたドラフトを分析し、画像プロンプトを生成してください：

### 1. 投稿タイプの判断

ドラフトを読んで、投稿タイプを判断します：

#### ストーリー投稿（失敗談・学び・問題提起）
**特徴**:
- 「悩み→判断→結果」の構造がある
- 失敗談や試行錯誤の過程がある
- フックで「誤解」を生み、本文で「回収」する

**画像の役割**: **フックのみ視覚化（オチは隠す）**
- 問題提起・疑問・感情トリガーのみ
- 解決策・結論は絶対に含めない
- 「続きを読む」を押させる疑問・緊張感を作る

#### ノウハウ投稿（Tips・手順・情報整理）
**特徴**:
- 具体的なステップ・ポイントがある
- 「〜したいなら」「〜の方法」等の実用情報
- 結論を先に示す構造

**画像の役割**: **具体的なステップを視覚化**
- 情報を整理して伝える
- 手順・ポイントを箇条書きやフローで表現

### 2. nano_banana.pyのテンプレート参照

以下のコマンドでテンプレート一覧を確認（実行不要、参考として理解）：

```bash
/Users/ksato/workspace/.venv/bin/python /Users/ksato/workspace/_codex/common/ops/scripts/nano_banana.py --list
```

**テンプレートの意図**:

| テンプレート | 用途 | オチの扱い |
|------------|------|-----------|
| `mystery` | 「なぜ？」を喚起 | 答えは見せない |
| `confession` | 問題の深刻さ | 解決策は見せない |
| `gap` | 期待と現実の対比 | 原因は見せない |
| `incident` | 感情トリガー（衝撃・警告） | 解決は見せない |
| `recovery` | V字グラフのみ | ストーリーは隠す |
| `progress` | 変化の方向性のみ | 具体的内容は隠す |
| `infographic` | 具体的な情報を整理 | 全て見せる（ノウハウ投稿用） |
| `framework` | 概念・構造を図解 | 全て見せる（ノウハウ投稿用） |

### 3. ストーリー投稿の画像プロンプト生成（最重要）

**フックのみ視覚化の原則**:

1. フックに出てくる「問題」「疑問」「感情」だけを視覚化
2. 本文の「判断」「結果」は絶対に含めない
3. 「続きを読む」を押させるための疑問・緊張感を作る

**例（Vibe Coding告知）**:

**ドラフト**:
```
【フック】
技術チーム、いない状態でリリースするの、危険すぎる

【本文】
自分で作った。Cursor、Claude Code。
動く。完璧に動く。
顧客も「これ使いたい」って言ってる。
さあ、リリース。
...本当に大丈夫？
- セキュリティ、専門家に見てもらった？
- エラー出たとき、誰が対応する？
- 機能追加、ずっと自分でやる？
技術が分かる人、社内にいない。
「作れた」と「運用できる」は、別物。

【CTA】
みんなはどうしてる？
```

**❌ NG（オチがネタバレ）**:
```
経営者・事業責任者の不安と解決策を対比するビジュアル：

【左側：不安】
- 一人の人物シルエット
- 「セキュリティ？」「メンテナンス？」

【中央：矢印と解決策】★NG：解決策を見せている
- 大きな右向き矢印
- 「商用化支援」のテキスト
- 「継続メンテナンス」のテキスト

【右側：安心】★NG：結論を見せている
- 複数の人物シルエット（技術チーム）
- 「リリース後も安心」のテキスト
```

**✅ OK（フックのみ視覚化）**:
```
日本語のmysteryビジュアルを作成してください：

テーマ: 技術チーム、いない状態でリリースするの、危険すぎる

デザイン要件:
- 中央に大きな「？」マーク
- 左側：一人の人物シルエット
- 周りに浮かぶ不安要素：「セキュリティ？」「メンテナンス？」「トラブル時は？」
- 警告マーク（⚠️）
- 孤独感を表現
- 解決策や「技術チーム」は絶対に表示しない★重要
- 横長レイアウト（16:9アスペクト比）

重要: すべて日本語で表示してください。
```

### 4. ノウハウ投稿の画像プロンプト生成

**具体的ステップ視覚化の原則**:

1. 本文の具体的なステップ・ポイントを視覚化
2. 情報を整理して伝える
3. フローチャート・箇条書き・図解を使う

**例（階段構文）**:

**ドラフト**:
```
【フック】
AIで面倒なことを自動化したいなら

【本文】
ChatGPTを触りまくる
↓
Nano Banana Proを触りまくる
↓
n8nを触りまくる
↓
AIでGASを書きまくる
↓
CursorでTypescriptを書きまくる

【CTA】
この流れは覚えておいて
```

**画像プロンプト**:
```
日本語のinfographicビジュアルを作成してください：

テーマ: AIで面倒なことを自動化する5ステップ

デザイン要件:
- 縦に並んだ5つのステップボックス
- ステップ1: ChatGPT を触りまくる
- ステップ2: Nano Banana Pro を触りまくる
- ステップ3: n8n を触りまくる
- ステップ4: AI で GAS を書きまくる
- ステップ5: Cursor で Typescript を書きまくる
- 各ステップを↓で繋ぐ
- 横長レイアウト（16:9アスペクト比）

重要: すべて日本語で表示してください。
```

### 5. 共通要件

**必ず含める**:
- `横長レイアウト（16:9アスペクト比）`
- `重要: すべて日本語で表示してください。`

**トピック（タイトル）**:
- フックから抽出した短いタイトルを含める

## Output Format

以下の形式で出力してください（markdownの見出しを厳守）：

```markdown
# Phase 3 実行結果: Image Prompt Generation

## 投稿タイプ判定

**タイプ**: [ストーリー投稿/ノウハウ投稿]
**判定理由**: [構造・内容に基づく理由]
**画像の役割**: [フックのみ視覚化/具体的ステップ視覚化]

## 推奨テンプレート

**テンプレート**: [mystery/confession/gap/infographic/framework 等]
**選定理由**: [投稿タイプに基づく理由]

## 生成した画像プロンプト

```
[生成した画像プロンプト全文]
```

## オチネタバレチェック

- [ ] ストーリー投稿の場合：フックのみ視覚化（本文の「判断」「結果」を含まない）
- [ ] ノウハウ投稿の場合：具体的ステップを視覚化
- [ ] 「横長レイアウト（16:9アスペクト比）」を含む
- [ ] 「重要: すべて日本語で表示してください。」を含む

---

この画像プロンプトをnano_banana.pyに渡してください。
```

## Important Notes

1. **オチネタバレの回避**: ストーリー投稿では「解決策」「結論」を絶対に含めない
2. **フック分析**: フックに出てくる「問題」「疑問」「感情」だけを視覚化
3. **投稿タイプ判断**: ストーリー型かノウハウ型かを正確に判断
4. **日本語表示**: 必ず「重要: すべて日本語で表示してください。」を含める

## Success Criteria

- ✅ 投稿タイプ（ストーリー/ノウハウ）が判定されている
- ✅ ストーリー投稿の場合、フックのみ視覚化している
- ✅ ノウハウ投稿の場合、具体的ステップを視覚化している
- ✅ 推奨テンプレートが選定されている
- ✅ 画像プロンプトが生成されている
- ✅ オチネタバレチェックをパスしている

このSubagentの画像プロンプトが、nano_banana.pyで画像生成に使用されます。
