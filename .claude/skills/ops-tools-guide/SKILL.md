---
name: ops-tools-guide
description: é‹ç”¨ãƒ»ãƒ„ãƒ¼ãƒ«çµ±åˆã‚¬ã‚¤ãƒ‰ï¼ˆ9 Skillsçµ±åˆç‰ˆï¼‰ã€‚Claude Codeå®Ÿè·µãƒ‘ã‚¿ãƒ¼ãƒ³ã€brainbaseé‹ç”¨å®‰å…¨æ€§ã€ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ã€GitHub Actionsã€worktreeé–‹ç™ºã€ç’°å¢ƒå¤‰æ•°ç®¡ç†ã€Branch & Worktreeé‹ç”¨ã€CI/CDèªè¨¼ã‚’çµ±åˆã—ãŸå®Ÿè·µã‚¬ã‚¤ãƒ‰
---

**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: v4.0ï¼ˆ11 Skillsçµ±åˆç‰ˆï¼‰
**å®Ÿè£…æ—¥**: 2025-12-30ï¼ˆv2.0ï¼‰ã€2025-12-30ï¼ˆv3.0ï¼‰ã€2025-12-31ï¼ˆv4.0ï¼‰
**çµ±åˆæ¸ˆã¿Skills**: 11å€‹
**çµ±åˆå¾Œã‚µã‚¤ã‚º**: ç´„2,050è¡Œ âœ… OPTIMALç¯„å›²ï¼ˆ1000-3000è¡Œï¼‰

---

## çµ±åˆSkillsä¸€è¦§

| # | å…ƒSkillå | è¡Œæ•° | ä¸»è¦å†…å®¹ |
|---|----------|------|---------|
| 1 | claude-code-patterns | 286è¡Œ | Claude Code Hooksè¨­å®šã€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆå‚ç…§ã€å­¦ç¿’ç®¡ç† |
| 2 | brainbase-ops-safety | 304è¡Œ | brainbaseé‹ç”¨å®‰å…¨æ€§ã€ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã€ãƒ‡ãƒ—ãƒ­ã‚¤ |
| 3 | brainbase-ui-launchd-gotchas | 148è¡Œ | launchdè‡ªå‹•èµ·å‹•ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° |
| 4 | brainbase-ui-version | 139è¡Œ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ«ãƒ¼ãƒ«ã€å¤‰æ›´å±¥æ­´ |
| 5 | github-actions-management | 53è¡Œ | GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç®¡ç† |
| 6 | worktree-dev-server | 60è¡Œ | worktreeé–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãƒãƒ¼ãƒˆç«¶åˆå›é¿ |
| 7 | env-management | 357è¡Œ | ç’°å¢ƒå¤‰æ•°ç®¡ç†ã€Slack/Airtable/AWSåŒæœŸ |
| 8 | branch-worktree-rules | 320è¡Œ | Branch & Worktreeé‹ç”¨ã€ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯æ–¹å¼ |
| 9 | code-cicd-auth | 200è¡Œ | CI/CDèªè¨¼ã€setup-tokenã€GitHub Actionsè¨­å®š |
| 10 | branch-worktree-rules | 320è¡Œ | Branch & Worktreeé‹ç”¨ã€ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯æ–¹å¼ |
| 11 | code-cicd-auth | 200è¡Œ | CI/CDèªè¨¼ã€setup-tokenã€GitHub Actionsè¨­å®š |

---

## Triggersï¼ˆã“ã®Skillã‚’ä½¿ã†ã‚¿ã‚¤ãƒŸãƒ³ã‚°ï¼‰

ä»¥ä¸‹ã®çŠ¶æ³ã§ä½¿ç”¨ï¼š

**Claude Codeé‹ç”¨**:
- Claude Code Hooksã‚’è¨­å®šã™ã‚‹ã¨ã
- @pathè¨˜æ³•ã§ãƒ•ã‚¡ã‚¤ãƒ«å‚ç…§ã—ãŸã„ã¨ã
- JSONå½¢å¼ã®ã¿ã§å‡ºåŠ›ã•ã›ãŸã„ã¨ã
- å­¦ç¿’å€™è£œã‚’ç®¡ç†ã—ãŸã„ã¨ã
- HooksãŒå‹•ä½œã—ãªã„éš›ã®ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

**brainbaseé‹ç”¨**:
- ãƒ—ãƒ­ã‚»ã‚¹ã®å¼·åˆ¶çµ‚äº†ã‚„ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ã‚’è¡Œã†ã¨ã
- æœ¬ç•ªç’°å¢ƒã§ã‚·ã‚¹ãƒ†ãƒ ã‚³ãƒãƒ³ãƒ‰ã‚’å®Ÿè¡Œã™ã‚‹ã¨ã
- ã‚µãƒ¼ãƒ“ã‚¹ã®å†èµ·å‹•ã‚„ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹ã‚’è¡Œã†ã¨ã
- brainbase-uiã®ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸã¨ã
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã‚’æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ã¨ã
- worktreeã§ä½œæ¥­ã‚’é–‹å§‹ã™ã‚‹ã¨ã
- ã‚³ãƒŸãƒƒãƒˆå…ˆã‚’ç¢ºèªã—ãŸã„ã¨ã

**é–‹ç™ºãƒ„ãƒ¼ãƒ«**:
- GitHub Actionsãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã‚’ä½œæˆãƒ»å¤‰æ›´ã™ã‚‹ã¨ã
- worktreeã‹ã‚‰é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ã‚’èµ·å‹•ã—ãŸã„ã¨ã
- ãƒãƒ¼ãƒˆç«¶åˆã‚’å›é¿ã—ãŸã„ã¨ã
- ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ ãƒ»æ›´æ–°ã™ã‚‹ã¨ã
- Claude Codeã‚’CI/CDãƒ»è‡ªå‹•åŒ–ç’°å¢ƒã§ä½¿ã„ãŸã„ã¨ã
- ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã§Claude Codeã‚’è‡ªå‹•å®Ÿè¡Œã—ãŸã„ã¨ã
- ã‚¿ã‚¹ã‚¯é–‹å§‹å‰ã«è©²å½“Skillã‚’ç¢ºèªã—ãŸã„ã¨ã

---

# Quick Reference

## çŠ¶æ³åˆ¥ã‚¯ã‚¤ãƒƒã‚¯ã‚¬ã‚¤ãƒ‰

| çŠ¶æ³ | å‚ç…§ã‚»ã‚¯ã‚·ãƒ§ãƒ³ | ã‚­ãƒ¼æ“ä½œ |
|------|-------------|---------|
| HooksãŒå‹•ä½œã—ãªã„ | Â§ 1.1 | `cat ~/.config/claude-code/settings.json \| jq '.hooks'` |
| ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãªã„ | Â§ 2.1 | `ps aux \| grep "[n]ode.*server.js"` â†’ `pkill -f "node.*server.js"` |
| launchdè‡ªå‹•èµ·å‹•ã‚’åœæ­¢ | Â§ 2.2, Â§ 3 | `launchctl unload ~/Library/LaunchAgents/com.brainbase.ui.plist` |
| ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–° | Â§ 4 | package.json + index.html (2ç®‡æ‰€) â†’ commit |
| GitHub Actionsè¿½åŠ  | Â§ 5 | ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä½œæˆ â†’ `scheduled-jobs.md` æ›´æ–° |
| worktreeã§ã‚µãƒ¼ãƒãƒ¼èµ·å‹• | Â§ 6 | `PORT=31014 npm run dev` |
| ç’°å¢ƒå¤‰æ•°è¿½åŠ  | Â§ 7.4 | `.env` è¿½åŠ  â†’ GitHub SecretsåŒæœŸ â†’ LambdaåŒæœŸ |
| Slackãƒˆãƒ¼ã‚¯ãƒ³æ›´æ–° | Â§ 7.2 | `.env` æ›´æ–° â†’ GitHub SecretsåŒæœŸ |
| worktreeä½œæ¥­é–‹å§‹ | Â§ 8 | ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ç¢ºèª â†’ ã‚³ãƒŸãƒƒãƒˆå…ˆåˆ†é›¢ |
| CI/CDèªè¨¼è¨­å®š | Â§ 9 | `claude setup-token` â†’ GitHub Secretsè¨­å®š |

---

## Task Start Skill Checkï¼ˆSkill Trigger Indexï¼‰

ã‚¿ã‚¹ã‚¯é–‹å§‹å‰ã«**è©²å½“SkillãŒã‚ã‚‹ã‹ã‚’å¿…ãšç¢ºèª**ã™ã‚‹ã€‚

- ãƒã‚°ä¿®æ­£: `verify-first-debugging`
- ãƒ†ã‚¹ãƒˆ: `tdd-workflow`
- ãƒªãƒ•ã‚¡ã‚¯ã‚¿: `refactoring-workflow`
- ã‚³ãƒŸãƒƒãƒˆ: `git-commit-rules`
- XæŠ•ç¨¿: `sns-smart`
- noteè¨˜äº‹: `note-smart`
- æ–°è¦ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆ: `project-onboarding`
- æ–°è¦äº‹æ¥­: `90day-checklist`
- ãƒãƒ¼ã‚±æˆ¦ç•¥: `marketing-strategy-planner`

---

## æ€è€ƒãƒ•ãƒ¬ãƒ¼ãƒ ãƒ¯ãƒ¼ã‚¯é€£æº

### Â§ 1ï¼ˆClaude Codeï¼‰Ã— Â§ 2ï¼ˆbrainbaseé‹ç”¨å®‰å…¨ï¼‰

**çµ±åˆæ´»ç”¨ãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
é–‹ç™ºã‚¿ã‚¹ã‚¯ â†’ ã€ŒClaude Codeã§è‡ªå‹•åŒ–ã§ãã‚‹ã‹?ã€
       â†“
Â§ 1 Claude Code Hooksè¨­å®šï¼ˆè‡ªå‹•åŒ–ï¼‰
       â†“
Â§ 2 brainbaseé‹ç”¨å®‰å…¨ï¼ˆãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ï¼‰
       â†“
Â§ 4 ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ï¼ˆå¤‰æ›´è¿½è·¡ï¼‰
```

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
ãƒ—ãƒ­ã‚»ã‚¹å¼·åˆ¶çµ‚äº†ãŒå¿…è¦ â†’ ã€Œæœ¬ç•ªã‚µãƒ¼ãƒ“ã‚¹ã‚’æ­¢ã‚ãªã„ã‹?ã€
Â§ 2.1 killall/pkillã®ä½¿ã„åˆ†ã‘ â†’ ç‰¹å®šãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿çµ‚äº†

é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãªã„ â†’ ã€Œè¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå‹•ã„ã¦ã„ãªã„ã‹?ã€
Â§ 2.1 StateStoreç«¶åˆç¢ºèª â†’ æ—¢å­˜ãƒ—ãƒ­ã‚»ã‚¹åœæ­¢

ç’°å¢ƒå¤‰æ•°ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„ â†’ ã€Œ.envã®å¤‰æ•°å±•é–‹ãŒå‹•ä½œã—ã¦ã„ã‚‹ã‹?ã€
Â§ 7.8 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° â†’ ç›´æ¥å€¤ã‚’ã‚³ãƒ”ãƒ¼
```

---

# Â§ 1. Claude Codeå®Ÿè·µãƒ‘ã‚¿ãƒ¼ãƒ³

> **å‡ºå…¸**: claude-code-patterns (é‹ç”¨æ™‚ã®gotchaã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹)

## 1.0 Memory Check Protocolï¼ˆ3å±¤ç¢ºèªãƒ•ãƒ­ãƒ¼ï¼‰

å›ç­”å‰ã«å¿…ãš**3å±¤ãƒ¡ãƒ¢ãƒª**ã‚’ç¢ºèªã™ã‚‹ã€‚è¿·ã£ãŸã‚‰ç¢ºèªã™ã‚‹ã€æ¢ã•ãªã„ç†ç”±ãŒãªã„é™ã‚Šæ¢ã™ã€‚

1. Brainbase MCPï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»äººç‰©ãƒ»çµ„ç¹”ãƒ»RACIï¼‰
2. ZEP MCPï¼ˆéå»ã®æ±ºå®šäº‹é …ãƒ»ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆï¼‰
3. ãƒ­ãƒ¼ã‚«ãƒ«_codexï¼ˆè©³ç´°ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰

## 1.1 Claude Code Hooksè¨­å®š

### JSONå½¢å¼ã¯å¿…ãš `{"hooks": {...}}` ã®ãƒã‚¹ãƒˆæ§‹é€ ã§è¨˜è¿°ã™ã‚‹

**å•é¡Œ**: hooksè¨­å®šã‚’ãƒˆãƒƒãƒ—ãƒ¬ãƒ™ãƒ«ã«ç›´æ¥æ›¸ãã¨å‹•ä½œã—ãªã„

```json
âŒ èª¤ã£ãŸä¾‹
{
  "sessionStart": {...},
  "userPromptSubmit": {...}
}
```

```json
âœ… æ­£ã—ã„ä¾‹
{
  "hooks": {
    "sessionStart": {...},
    "userPromptSubmit": {...}
  }
}
```

**åŸå› **: Claude Codeã®è¨­å®šãƒ‘ãƒ¼ã‚µãƒ¼ã¯ `hooks` ã‚­ãƒ¼ã®å­˜åœ¨ã‚’å‰æã¨ã—ã¦ã„ã‚‹

**ç¢ºèªæ–¹æ³•**:
```bash
# è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹é€ ã‚’ç¢ºèª
cat ~/.config/claude-code/settings.json | jq '.hooks'
```

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
HooksãŒå‹•ä½œã—ãªã„ â†’ ã€Œãƒã‚¹ãƒˆæ§‹é€ ã«ãªã£ã¦ã„ã‚‹ã‹?ã€
è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ç¢ºèª â†’ `jq '.hooks'` ã§ç¢ºèª
```

---

### Stopãƒˆãƒªã‚¬ãƒ¼ã¯ã€Œã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆã®å¿œç­”å®Œäº†æ™‚ã®ã¿ã€ç™ºç«ã™ã‚‹

**é‡è¦**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ã‚ˆã‚‹ä¸­æ–­ï¼ˆCtrl+Cç­‰ï¼‰ã§ã¯ç™ºç«ã—ãªã„

```yaml
hooks:
  stop:
    command: "echo 'cleanup after response'"
```

**ç™ºç«ã™ã‚‹ã‚±ãƒ¼ã‚¹**:
- ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆãŒå¿œç­”ã‚’å®Œäº†ã—ãŸç›´å¾Œ
- ã‚¨ãƒ©ãƒ¼ãªãæ­£å¸¸çµ‚äº†ã—ãŸæ™‚

**ç™ºç«ã—ãªã„ã‚±ãƒ¼ã‚¹**:
- ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒCtrl+Cã§ä¸­æ–­ã—ãŸæ™‚
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒã‚¯ãƒ©ãƒƒã‚·ãƒ¥ã—ãŸæ™‚
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆã§å¼·åˆ¶çµ‚äº†ã—ãŸæ™‚

**é©ã—ãŸç”¨é€”**:
- å¿œç­”å®Œäº†å¾Œã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
- ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ±è¨ˆã®è¨˜éŒ²
- å®Œäº†é€šçŸ¥ã®é€ä¿¡

**ä¸é©åˆ‡ãªç”¨é€”**:
- å¿…ãšå®Ÿè¡Œã•ã‚Œã‚‹ã¹ãã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—ï¼ˆâ†’ sessionEndæ¨å¥¨ï¼‰
- ä¸­æ–­æ™‚ã®çŠ¶æ…‹ä¿å­˜ï¼ˆâ†’ åˆ¥ã®ä»•çµ„ã¿ãŒå¿…è¦ï¼‰

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
å¿œç­”å®Œäº†å¾Œã®å‡¦ç† â†’ Stopãƒˆãƒªã‚¬ãƒ¼ä½¿ç”¨
ä¸­æ–­æ™‚ã‚‚å®Ÿè¡ŒãŒå¿…è¦ â†’ sessionEndãƒˆãƒªã‚¬ãƒ¼æ¤œè¨
```

---

## 1.2 ãƒ‡ãƒãƒƒã‚°ã¨ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### HooksãŒå‹•ä½œã—ãªã„æ™‚ã®ç¢ºèªæ‰‹é †

1. **è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã®æ§‹æ–‡ãƒã‚§ãƒƒã‚¯**
   ```bash
   cat ~/.config/claude-code/settings.json | jq .
   ```
   ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹å ´åˆã¯JSONæ§‹æ–‡ã‚¨ãƒ©ãƒ¼

2. **hooks ã‚­ãƒ¼ã®å­˜åœ¨ç¢ºèª**
   ```bash
   cat ~/.config/claude-code/settings.json | jq '.hooks'
   ```
   `null` ãŒè¿”ã‚‹å ´åˆã¯è¨­å®šå½¢å¼ãŒèª¤ã£ã¦ã„ã‚‹

3. **ã‚³ãƒãƒ³ãƒ‰ã®å®Ÿè¡Œæ¨©é™ç¢ºèª**
   ```bash
   # ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ç›´æ¥å®Ÿè¡Œã—ã¦ã¿ã‚‹
   bash /path/to/hook-script.sh
   ```

4. **ãƒ­ã‚°ã®ç¢ºèª**
   Hooksã®å®Ÿè¡Œãƒ­ã‚°ã¯ Claude Code ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ­ã‚°ã«å‡ºåŠ›ã•ã‚Œã‚‹

### ã‚ˆãã‚ã‚‹ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³

| ã‚¨ãƒ©ãƒ¼ç—‡çŠ¶ | åŸå›  | è§£æ±ºç­– |
|-----------|------|--------|
| HooksãŒå…¨ãå‹•ä½œã—ãªã„ | `{"hooks": {...}}` å½¢å¼ã«ãªã£ã¦ã„ãªã„ | ãƒã‚¹ãƒˆæ§‹é€ ã«ä¿®æ­£ |
| StopãŒç™ºç«ã—ãªã„ | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒä¸­æ–­ã—ã¦ã„ã‚‹ | sessionEndãƒˆãƒªã‚¬ãƒ¼ã‚’æ¤œè¨ |
| ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒã‚¨ãƒ©ãƒ¼ã«ãªã‚‹ | ãƒ‘ã‚¹ãŒç›¸å¯¾ãƒ‘ã‚¹ | çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›´ |
| ç’°å¢ƒå¤‰æ•°ãŒä½¿ãˆãªã„ | ã‚·ã‚§ãƒ«ã®åˆæœŸåŒ–ãŒä¸å®Œå…¨ | ã‚¹ã‚¯ãƒªãƒ—ãƒˆå†…ã§æ˜ç¤ºçš„ã«source |

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
HooksãŒå‹•ä½œã—ãªã„ â†’ ç¢ºèªæ‰‹é †1-4ã‚’é †ã«å®Ÿè¡Œ
ã‚¨ãƒ©ãƒ¼ãƒ‘ã‚¿ãƒ¼ãƒ³ã«è©²å½“ â†’ å¯¾å¿œã™ã‚‹è§£æ±ºç­–ã‚’é©ç”¨
```

---

## 1.3 å®Ÿè·µçš„ãªHooksè¨­å®šä¾‹

### ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹æ™‚ã®ç’°å¢ƒãƒã‚§ãƒƒã‚¯

```json
{
  "hooks": {
    "sessionStart": {
      "command": "~/.config/claude-code/hooks/check-environment.sh",
      "showOutput": true
    }
  }
}
```

### å¿œç­”å®Œäº†å¾Œã®çµ±è¨ˆè¨˜éŒ²

```json
{
  "hooks": {
    "stop": {
      "command": "echo \"Session completed: $(date)\" >> ~/claude-sessions.log",
      "showOutput": false
    }
  }
}
```

### è¤‡æ•°ã®ãƒˆãƒªã‚¬ãƒ¼ã‚’çµ„ã¿åˆã‚ã›ãŸæ§‹æˆ

```json
{
  "hooks": {
    "sessionStart": {
      "command": "/path/to/startup-check.sh",
      "showOutput": true
    },
    "userPromptSubmit": {
      "command": "/path/to/log-prompt.sh",
      "showOutput": false
    },
    "stop": {
      "command": "/path/to/cleanup.sh",
      "showOutput": false
    }
  }
}
```

---

## 1.4 ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆãƒ‘ã‚¿ãƒ¼ãƒ³

### @pathè¨˜æ³•ã«ã‚ˆã‚‹å‹•çš„ãƒ•ã‚¡ã‚¤ãƒ«å‚ç…§

Claude Codeã§ãƒ•ã‚¡ã‚¤ãƒ«ã®å†…å®¹ã‚’ç›´æ¥ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¨ã—ã¦èª­ã¿è¾¼ã‚€è¨˜æ³•ï¼š

```
@/path/to/file
```

**ä½¿ç”¨ä¾‹**:
```bash
# ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ã®å†…å®¹ã‚’ç›´æ¥å®Ÿè¡Œ
claude @/Users/ksato/workspace/.claude/commands/commit.md

# è¤‡æ•°ãƒ•ã‚¡ã‚¤ãƒ«ã®çµ„ã¿åˆã‚ã›
claude @/path/to/context.md "ä¸Šè¨˜ã‚’è¸ã¾ãˆã¦å®Ÿè£…ã—ã¦ãã ã•ã„"
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã®å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒ–ã§ç®¡ç†ãŒå®¹æ˜“
- é•·å¤§ãªæŒ‡ç¤ºã‚’å†åˆ©ç”¨å¯èƒ½
- ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãŒå¯èƒ½

**æ³¨æ„ç‚¹**:
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã¯çµ¶å¯¾ãƒ‘ã‚¹ã‚’æ¨å¥¨
- ãƒ•ã‚¡ã‚¤ãƒ«ãŒå­˜åœ¨ã—ãªã„å ´åˆã¯ã‚¨ãƒ©ãƒ¼

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
é•·å¤§ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ â†’ @pathè¨˜æ³•ã§å¤–éƒ¨ãƒ•ã‚¡ã‚¤ãƒ«åŒ–
å†åˆ©ç”¨å¯èƒ½ã«ã—ãŸã„ â†’ ãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜
```

---

### JSONå½¢å¼ã®ã¿ã§å‡ºåŠ›ã•ã›ã‚‹æ–¹æ³•

èª¬æ˜æ–‡ã‚„ãƒãƒ¼ã‚¯ãƒ€ã‚¦ãƒ³ã‚’é™¤ãã€JSONãƒšã‚¤ãƒ­ãƒ¼ãƒ‰ã®ã¿ã‚’è¿”ã•ã›ã‚‹æŒ‡ç¤ºï¼š

```
ä»¥ä¸‹ã®å†…å®¹ã‚’JSONã®ã¿ã§å‡ºåŠ›ã—ã¦ãã ã•ã„ã€‚èª¬æ˜æ–‡ã¯ä¸è¦ã§ã™ã€‚

{...}
```

**åŠ¹æœ**:
- æ©Ÿæ¢°å‡¦ç†ãŒå®¹æ˜“ï¼ˆãƒ‘ãƒ¼ã‚¹ã‚¨ãƒ©ãƒ¼ã‚’é˜²ãï¼‰
- å¾Œå‡¦ç†ã®æ¨™æº–åŒ–
- ã‚¹ã‚¯ãƒªãƒ—ãƒˆã§ã®è‡ªå‹•å‡¦ç†ã«æœ€é©

**ä½¿ç”¨ä¾‹**:
```bash
# å­¦ç¿’å€™è£œã‚’JSONå½¢å¼ã§æŠ½å‡º
claude "ä»¥ä¸‹ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã‹ã‚‰å­¦ç¿’å†…å®¹ã‚’æŠ½å‡ºã—ã€JSONã®ã¿ã§å‡ºåŠ›ã—ã¦ãã ã•ã„"
```

**æ³¨æ„ç‚¹**:
- ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã§æ˜ç¢ºã«ã€ŒJSONã®ã¿ã€ã¨æŒ‡ç¤ºã™ã‚‹
- Claude Codeã®å‡ºåŠ›å½¢å¼åˆ¶å¾¡ã¨çµ„ã¿åˆã‚ã›ã‚‹

---

## 1.5 å­¦ç¿’ç®¡ç†ãƒ‘ã‚¿ãƒ¼ãƒ³

### JSONæ§‹é€ åŒ–ã«ã‚ˆã‚‹å­¦ç¿’ã®ç®¡ç†

å­¦ç¿’å†…å®¹ã‚’ä»¥ä¸‹ã®JSONå½¢å¼ã§æ§‹é€ åŒ–ï¼š

```json
{
  "title": "å­¦ç¿’ã‚¿ã‚¤ãƒˆãƒ«",
  "category": "workflow | architecture | gotcha | ...",
  "content": "å­¦ç¿’å†…å®¹ã®è©³ç´°",
  "tags": ["tag1", "tag2"],
  "confidence": 0.95
}
```

**ãƒ¡ãƒªãƒƒãƒˆ**:
- æ©Ÿæ¢°å‡¦ç†å¯èƒ½ãªå½¢å¼
- å­¦ç¿’ã®å†åˆ©ç”¨æ€§ãƒ»æ¤œç´¢æ€§å‘ä¸Š
- é›†ç´„ãƒ»åˆ†æãŒå®¹æ˜“

**é‹ç”¨ãƒ•ãƒ­ãƒ¼**:
1. ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã«å­¦ç¿’å†…å®¹ã‚’æŠ½å‡º
2. JSONå½¢å¼ã§æ§‹é€ åŒ–
3. `.claude/learning/learning_queue/` ã«ä¿å­˜
4. `/learn-skills` ã§ç¢ºèªãƒ»é©ç”¨

### ä¿¡é ¼åº¦ã‚¹ã‚³ã‚¢ï¼ˆconfidenceï¼‰ã«ã‚ˆã‚‹å“è³ªè©•ä¾¡

å­¦ç¿’å†…å®¹ã®ä¿¡é ¼åº¦ã‚’0.0ã€œ1.0ã®ã‚¹ã‚³ã‚¢ã§è©•ä¾¡ï¼š

| ä¿¡é ¼åº¦ | åŸºæº– |
|--------|------|
| 0.95ã€œ | æ¤œè¨¼æ¸ˆã¿ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ |
| 0.8ã€œ0.94 | å®Ÿè·µçš„ãªå­¦ç¿’å†…å®¹ |
| 0.5ã€œ0.79 | å‚è€ƒæƒ…å ± |
| ã€œ0.49 | æœªæ¤œè¨¼ãƒ»è¦ç¢ºèª |

**ä½¿ç”¨ä¾‹**:
```bash
# ä¿¡é ¼åº¦0.8ä»¥ä¸Šã®å­¦ç¿’å€™è£œã‚’æŠ½å‡º
jq '.confidence >= 0.8' learning_queue/*.json
```

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
å­¦ç¿’å†…å®¹ã®æŠ½å‡º â†’ JSONæ§‹é€ åŒ– â†’ ä¿¡é ¼åº¦è©•ä¾¡
ä¿¡é ¼åº¦0.8ä»¥ä¸Š â†’ å­¦ç¿’å€™è£œã¨ã—ã¦æ¡ç”¨
```

---

## 1.6 Gotchaã¨æ•™è¨“

### Webèª¿æŸ»ã®é‡è¦æ€§

**äº‹ä¾‹**: Skillsã¨ã‚«ã‚¹ã‚¿ãƒ ã‚³ãƒãƒ³ãƒ‰ã®ä½œã‚Šæ–¹ã«ã¤ã„ã¦ã€æœ€åˆã¯èª¤ã£ãŸæ–¹æ³•ã‚’ææ¡ˆ

**æ•™è¨“**: å®Ÿè£…æ–¹æ³•ãŒä¸ç¢ºã‹ãªå ´åˆã¯å¿…ãšWebã§ç¢ºèªã™ã‚‹

**å¯¾ç­–**:
- å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’ç¬¬ä¸€ã«å‚ç…§
- å®Ÿè£…ä¾‹ã‚’è¤‡æ•°ç¢ºèª
- ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹ã‚’èª¿æŸ»

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
å®Ÿè£…æ–¹æ³•ãŒä¸ç¢ºã‹ â†’ Webèª¿æŸ»å®Ÿæ–½
å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç¢ºèª â†’ å®Ÿè£…ä¾‹è¤‡æ•°ç¢ºèª
```

---

# Â§ 2. brainbaseé‹ç”¨å®‰å…¨ã‚¬ã‚¤ãƒ‰

> **å‡ºå…¸**: brainbase-ops-safety (æœ¬ç•ªç’°å¢ƒã§ã®é‡å¤§ãªå¤±æ•—ã‚’é˜²ã)

## 2.1 ãƒ—ãƒ­ã‚»ã‚¹ç®¡ç†ã®æ³¨æ„ç‚¹

### killall/pkillã®ä½¿ã„åˆ†ã‘ - æœ¬ç•ªã‚µãƒ¼ãƒ“ã‚¹åœæ­¢ã®ãƒªã‚¹ã‚¯

**å•é¡Œ**: `killall -9 node` ã‚„ `killall -9 npx` ã¯æœ¬ç•ªã‚µãƒ¼ãƒ“ã‚¹ã‚’å«ã‚€å…¨ã¦ã®ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢ã™ã‚‹

```bash
âŒ çµ¶å¯¾ã«ã‚„ã£ã¦ã¯ã„ã‘ãªã„ä¾‹
killall -9 node      # å…¨ã¦ã®nodeãƒ—ãƒ­ã‚»ã‚¹ã‚’å¼·åˆ¶çµ‚äº†
killall -9 npx       # å…¨ã¦ã®npxãƒ—ãƒ­ã‚»ã‚¹ã‚’å¼·åˆ¶çµ‚äº†

â†’ æœ¬ç•ªã‚µãƒ¼ãƒ“ã‚¹ï¼ˆbrainbase-uiã€MCP serversç­‰ï¼‰ãŒå…¨ã¦åœæ­¢
â†’ å¾©æ—§ã«å¤šå¤§ãªæ™‚é–“ãŒã‹ã‹ã‚‹
```

```bash
âœ… æ­£ã—ã„ä¾‹: ç‰¹å®šã®ãƒ—ãƒ­ã‚»ã‚¹ãƒ‘ã‚¿ãƒ¼ãƒ³ã§çµã‚Šè¾¼ã‚€
# 1. äº‹å‰ã«å¯¾è±¡ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
ps aux | grep "claude.*dangerously-skip-permissions"

# 2. ç¢ºèªå¾Œã€ç‰¹å®šã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã®ã¿çµ‚äº†
pkill -9 -f "claude.*dangerously-skip-permissions"

# 3. å¿…è¦ã«å¿œã˜ã¦ä»–ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚‚
pkill -9 -f "mcp-server.*specific-pattern"
```

**åŸå› **:
- `killall` ã¯ãƒ—ãƒ­ã‚»ã‚¹åã®ã¿ã§ãƒãƒƒãƒã™ã‚‹
- node/npxã¯å¤šãã®ã‚µãƒ¼ãƒ“ã‚¹ã§å…±é€šã—ã¦ä½¿ã‚ã‚Œã¦ã„ã‚‹
- `-9` (SIGKILL) ã¯å³åº§ã«å¼·åˆ¶çµ‚äº†ã™ã‚‹ãŸã‚ã€å¾©æ—§å‡¦ç†ã‚‚å®Ÿè¡Œã•ã‚Œãªã„

**ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**:
1. **å¿…ãš `ps aux | grep <pattern>` ã§å¯¾è±¡ã‚’äº‹å‰ç¢ºèª**
2. **`pkill -f <pattern>` ã§ãƒ—ãƒ­ã‚»ã‚¹ã®ã‚³ãƒãƒ³ãƒ‰ãƒ©ã‚¤ãƒ³å…¨ä½“ã§ãƒãƒƒãƒ**
3. **æœ¬ç•ªç’°å¢ƒã§ã¯ `-9` ã®å‰ã«é€šå¸¸ã®ã‚·ã‚°ãƒŠãƒ« (SIGTERM) ã‚’è©¦ã™**
4. **worktreeç’°å¢ƒã§äº‹å‰ã«ãƒ†ã‚¹ãƒˆã™ã‚‹**

**ç¢ºèªæ–¹æ³•**:
```bash
# ç¾åœ¨å‹•ã„ã¦ã„ã‚‹nodeãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
ps aux | grep "[n]ode" | grep -v grep

# ç‰¹å®šã®ãƒãƒ¼ãƒˆã§ãƒªã‚¹ãƒ‹ãƒ³ã‚°ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
lsof -i :31013
netstat -an | grep LISTEN
```

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
ãƒ—ãƒ­ã‚»ã‚¹çµ‚äº†ãŒå¿…è¦ â†’ ã€Œæœ¬ç•ªã‚µãƒ¼ãƒ“ã‚¹ã‚’æ­¢ã‚ãªã„ã‹?ã€
killallä½¿ç”¨æ¤œè¨ â†’ ã€Œç‰¹å®šãƒ‘ã‚¿ãƒ¼ãƒ³ã§çµã‚Šè¾¼ã‚ã‚‹ã‹?ã€
ps aux ã§ç¢ºèª â†’ pkill -f <pattern> å®Ÿè¡Œ
```

---

### è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èµ·å‹•ã«ã‚ˆã‚‹StateStoreç«¶åˆ

**å•é¡Œ**: è¤‡æ•°ã®ã‚µãƒ¼ãƒãƒ¼ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒåŒæ™‚ã«å‹•ãã¨state.jsonã®èª­ã¿æ›¸ããŒç«¶åˆã™ã‚‹

```bash
âŒ çµ¶å¯¾ã«ã‚„ã£ã¦ã¯ã„ã‘ãªã„ä¾‹
# æ—¢ã«npm run devãŒå‹•ã„ã¦ã„ã‚‹ã®ã«ã€åˆ¥ã®ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§èµ·å‹•
npm start  # ã¾ãŸã¯ node server.js

â†’ 2ã¤ã®StateStoreã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒåŒã˜state.jsonã‚’æ“ä½œ
â†’ ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ãŒæ¶ˆãˆã‚‹ã€APIãŒå¤ã„ãƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ç­‰ã®å•é¡Œ
```

```bash
âœ… æ­£ã—ã„ä¾‹: å¿…ãšæ—¢å­˜ãƒ—ãƒ­ã‚»ã‚¹ã‚’åœæ­¢ã—ã¦ã‹ã‚‰èµ·å‹•

# 1. æ—¢å­˜ã®ã‚µãƒ¼ãƒãƒ¼ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
ps aux | grep "[n]ode.*server.js"
lsof -i:31013

# 2. æ—¢å­˜ãƒ—ãƒ­ã‚»ã‚¹ãŒã‚ã‚Œã°åœæ­¢
pkill -f "node.*server.js"
pkill -f "npm.*dev"
pkill -f "npm.*start"

# 3. æ­£æœ¬ã¯launchdã§å†èµ·å‹•ï¼ˆæ¨å¥¨ï¼‰
launchctl unload ~/Library/LaunchAgents/com.brainbase.ui.plist
launchctl load ~/Library/LaunchAgents/com.brainbase.ui.plist

# watch modeãŒå¿…è¦ãªå ´åˆï¼ˆæ‰‹å‹•ï¼‰
cd /Users/ksato/workspace/code/brainbase
PORT=31014 npm run dev
```

**æ­£ã—ã„èµ·å‹•æ–¹æ³•**:
- **æ­£æœ¬ï¼ˆmainï¼‰**: `launchdï¼ˆPORT=31013ï¼‰`
- **worktree**: `PORT=31014 npm run dev` ï¼ˆÂ§ 6å‚ç…§ï¼‰

**ä½¿ã„åˆ†ã‘**:
- `npm run dev`: ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’ç›£è¦–ã—ã¦è‡ªå‹•å†èµ·å‹•ï¼ˆé–‹ç™ºç”¨ï¼‰
- `npm start`: å˜ç´”èµ·å‹•ã€watcherãªã—ï¼ˆæœ¬ç•ª/ãƒ†ã‚¹ãƒˆç”¨ï¼‰

**ç¢ºèªæ–¹æ³•**:
```bash
# å‹•ã„ã¦ã„ã‚‹ã‚µãƒ¼ãƒãƒ¼ã®ç¢ºèª
ps aux | grep "[n]ode.*server.js"
lsof -i:31013

# ãƒ—ãƒ­ã‚»ã‚¹ã®èµ·å‹•å…ƒãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’ç¢ºèªï¼ˆé‡è¦ï¼ï¼‰
lsof -p <PID> | grep cwd
# â†’ /Users/ksato/workspace/code/brainbase ãŒæ­£ã—ã„
# â†’ /Users/ksato/workspace/brainbase-ui ãªã‚‰é–“é•ã„

# APIãŒæ­£ã—ãã‚»ãƒƒã‚·ãƒ§ãƒ³ã‚’è¿”ã™ã‹ç¢ºèª
curl -s http://localhost:31013/api/state | python3 -c "import sys, json; print(f'Sessions: {len(json.load(sys.stdin).get(\"sessions\", []))}')"
```

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
ã‚µãƒ¼ãƒãƒ¼èµ·å‹•å‰ â†’ ã€Œæ—¢å­˜ãƒ—ãƒ­ã‚»ã‚¹ãŒå‹•ã„ã¦ã„ãªã„ã‹?ã€
ps aux ç¢ºèª â†’ è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹æ¤œå‡º
æ—¢å­˜ãƒ—ãƒ­ã‚»ã‚¹åœæ­¢ â†’ æ–°è¦èµ·å‹•
```

---

### server.jsç·¨é›†æ™‚ã®æ³¨æ„ç‚¹ - BRAINBASE_ROOTå®šç¾©ã®å‰Šé™¤ç¦æ­¢

**å•é¡Œ**: server.jsç·¨é›†æ™‚ã«BRAINBASE_ROOTå®šç¾©ã‚’å‰Šé™¤ã™ã‚‹ã¨å…¨ãƒ‡ãƒ¼ã‚¿ãƒ‘ã‚¹ãŒå£Šã‚Œã‚‹

```bash
âŒ çµ¶å¯¾ã«ã‚„ã£ã¦ã¯ã„ã‘ãªã„ä¾‹
# BRAINBASE_ROOTå®šç¾©ã‚’å‰Šé™¤ã—ãŸçŠ¶æ…‹ã§server.jsã‚’ç·¨é›†

â†’ BRAINBASE_ROOTæœªå®šç¾©ã‚¨ãƒ©ãƒ¼
â†’ ãƒ‘ã‚¹ãŒå¤ã„ç›¸å¯¾ãƒ‘ã‚¹ï¼ˆ../ï¼‰ã«ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯
â†’ /Users/ksato/_tasks/index.md ãªã©å­˜åœ¨ã—ãªã„ãƒ‘ã‚¹ã‚’å‚ç…§
â†’ ã‚¿ã‚¹ã‚¯ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»ã‚»ãƒƒã‚·ãƒ§ãƒ³ãŒå…¨ã¦0ä»¶ã«ãªã‚‹
```

```bash
âœ… æ­£ã—ã„ä¾‹: BRAINBASE_ROOTå®šç¾©ã‚’å¿…ãšç¶­æŒ

// server.js ã®å¿…é ˆå®šç¾©ï¼ˆå‰Šé™¤ç¦æ­¢ï¼‰
const BRAINBASE_ROOT = detectBrainbaseRoot();
console.log(`[BRAINBASE] Root directory: ${BRAINBASE_ROOT}`);

// ã“ã®å®šç¾©ã®å¾Œã«ãƒ‘ã‚¹è¨­å®š
const TASKS_FILE = path.join(BRAINBASE_ROOT, '_tasks/index.md');
const SCHEDULES_DIR = path.join(BRAINBASE_ROOT, '_schedules');
```

**åŸå› **:
- server.js ã®éƒ¨åˆ†ç·¨é›†æ™‚ã« BRAINBASE_ROOT å®šç¾©éƒ¨åˆ†ã‚’å«ã‚ãšã« Edit ã—ã¦ã—ã¾ã†
- çµæœã¨ã—ã¦å®šç¾©ãŒå‰Šé™¤ã•ã‚Œã€å¾Œç¶šã®ãƒ‘ã‚¹è¨­å®šãŒå…¨ã¦å£Šã‚Œã‚‹
- ã‚¿ã‚¹ã‚¯ãƒ»ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ»è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ãŒèª­ã‚ãªããªã‚‹

**ç·¨é›†å¾Œã®å¿…é ˆç¢ºèª**:
```bash
# 1. BRAINBASE_ROOTå®šç¾©ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
grep "BRAINBASE_ROOT" /Users/ksato/workspace/code/brainbase/server.js

# 2. ã‚µãƒ¼ãƒãƒ¼èµ·å‹•æ™‚ã®ãƒ­ã‚°ã‚’ç¢ºèª
tail -f ~/Library/Logs/brainbase-ui.log | grep "Root directory"
# â†’ [BRAINBASE] Root directory: /Users/ksato/workspace/shared ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¹ã

# 3. ã‚¿ã‚¹ã‚¯èª­ã¿è¾¼ã¿ãƒ‘ã‚¹ã‚’ç¢ºèª
tail -f ~/Library/Logs/brainbase-ui.log | grep "Reading tasks from"
# â†’ Reading tasks from: /Users/ksato/workspace/shared/_tasks/index.md ãŒè¡¨ç¤ºã•ã‚Œã‚‹ã¹ã

# 4. APIãŒæ­£ã—ããƒ‡ãƒ¼ã‚¿ã‚’è¿”ã™ã‹ç¢ºèª
curl -s http://localhost:31013/api/tasks | python3 -c "import sys, json; print(f'Tasks: {len(json.load(sys.stdin))}')"
# â†’ Tasks: 121 ã®ã‚ˆã†ã«è¡¨ç¤ºã•ã‚Œã‚‹ã¹ãï¼ˆ0ä»¶ãªã‚‰å¤±æ•—ï¼‰
```

**é‡è¦**: server.jsç·¨é›†æ™‚ã¯å¿…ãšBRAINBASE_ROOTå®šç¾©ã‚’å«ã‚ã¦ç·¨é›†ã—ã€ç·¨é›†å¾Œã¯ä¸Šè¨˜4ç‚¹ã‚’ç¢ºèªã™ã‚‹

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
server.jsç·¨é›† â†’ ã€ŒBRAINBASE_ROOTå®šç¾©ã‚’å«ã‚ã¦ã„ã‚‹ã‹?ã€
ç·¨é›†å®Œäº† â†’ 4ç‚¹ç¢ºèªï¼ˆå®šç¾©å­˜åœ¨ã€ãƒ­ã‚°ã€ãƒ‘ã‚¹ã€APIï¼‰
ã‚¿ã‚¹ã‚¯0ä»¶ â†’ BRAINBASE_ROOTå®šç¾©å‰Šé™¤ã®å¯èƒ½æ€§
```

---

## 2.2 launchdã‚µãƒ¼ãƒ“ã‚¹ã®è‡ªå‹•èµ·å‹• - æ—§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã®èµ·å‹•å•é¡Œ

**å•é¡Œ**: launchdã‚µãƒ¼ãƒ“ã‚¹ãŒæ—§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰ã‚µãƒ¼ãƒãƒ¼ã‚’è‡ªå‹•èµ·å‹•ã—ã€è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ç«¶åˆã‚’å¼•ãèµ·ã“ã™

```bash
âŒ å•é¡Œã®ã‚ã‚‹çŠ¶æ…‹
# /Users/ksato/Library/LaunchAgents/com.brainbase.ui.plist ãŒå­˜åœ¨
# â†’ ã‚·ã‚¹ãƒ†ãƒ èµ·å‹•æ™‚ã« npm run dev ãŒè‡ªå‹•èµ·å‹•
# â†’ /Users/ksato/workspace/brainbase-ui ã‹ã‚‰èµ·å‹•ï¼ˆæ—§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªï¼‰
# â†’ æ‰‹å‹•èµ·å‹•ã—ãŸã‚µãƒ¼ãƒãƒ¼ã¨ç«¶åˆã—ã¦state.jsonç ´æ

# ç¢ºèªæ–¹æ³•
launchctl list | grep brainbase
ps aux | grep "[n]ode.*server.js"
lsof -p <PID> | grep cwd  # ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªç¢ºèª
```

```bash
âœ… æ­£ã—ã„å¯¾å‡¦æ–¹æ³•

# 1. plistã‚’æœ€æ–°åŒ–ï¼ˆWorkingDirectory/PORT/BRAINBASE_ROOTï¼‰
#    WorkingDirectory: /Users/ksato/workspace/code/brainbase
#    PORT: 31013
#    BRAINBASE_ROOT: /Users/ksato/workspace/shared

# 2. launchdã‚’å†èª­ã¿è¾¼ã¿
launchctl unload ~/Library/LaunchAgents/com.brainbase.ui.plist
pkill -9 -f "node.*server.js"  # æ—§ãƒ—ãƒ­ã‚»ã‚¹ã‚’å…¨åœæ­¢
launchctl load ~/Library/LaunchAgents/com.brainbase.ui.plist

# 3. watch modeã¯å¿…è¦æ™‚ã®ã¿åˆ¥ãƒãƒ¼ãƒˆã§èµ·å‹•
cd /Users/ksato/workspace/code/brainbase
PORT=31014 npm run dev
```

**åŸå› **:
- ãƒªãƒã‚¸ãƒˆãƒªç§»å‹•æ™‚ã«launchdã‚µãƒ¼ãƒ“ã‚¹ã®è¨­å®šãŒå¤ã„ã¾ã¾æ®‹ã‚‹
- plistã®WorkingDirectoryã‚’æ›´æ–°ã—ã¦ã‚‚launchdãŒã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ã†
- RunAtLoad=true + KeepAlive=true ã§å¸¸æ™‚èµ·å‹•çŠ¶æ…‹ã«ãªã‚‹
- ãƒ—ãƒ­ã‚»ã‚¹è¦ªãŒPID=1ï¼ˆã‚·ã‚¹ãƒ†ãƒ èµ·å‹•ï¼‰ãªã®ã§æ°—ã¥ãã«ãã„

**ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹**:
1. **æ­£æœ¬ï¼ˆmainï¼‰ã¯launchdã§çµ±ä¸€é‹ç”¨**ï¼ˆPORT=31013ï¼‰
2. **ãƒªãƒã‚¸ãƒˆãƒªç§»å‹•æ™‚ã¯ plist ã® WorkingDirectory ã‚’å¿…ãšæ›´æ–°**
3. **ãƒ—ãƒ­ã‚»ã‚¹ã®è¦ªPID ã¨ä½œæ¥­ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å¿…ãšç¢ºèª**
   ```bash
   ps -o pid,ppid,command | grep "[n]ode.*server.js"
   # PPID=1 ãªã‚‰ launchd ã‹ã‚‰èµ·å‹•ã•ã‚Œã¦ã„ã‚‹

   lsof -p <PID> | grep cwd
   # æ­£ã—ã„ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: /Users/ksato/workspace/code/brainbase
   # é–“é•ã£ãŸãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª: /Users/ksato/workspace/brainbase-ui
   ```
4. **watch modeã¯ PORT=31014 ã§åˆ†é›¢é‹ç”¨**

**ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**:
```bash
# ã‚µãƒ¼ãƒãƒ¼ãŒã€Œã¾ãŸæ­»ã‚“ã ã€å ´åˆã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

# 1. è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹ãŒå‹•ã„ã¦ã„ãªã„ã‹ï¼Ÿ
ps aux | grep "[n]ode.*server.js" | wc -l
# â†’ 4ã¤ä»¥ä¸Šãªã‚‰è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å•é¡Œ

# 2. æ—§ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‹ã‚‰èµ·å‹•ã—ã¦ã„ãªã„ã‹ï¼Ÿ
for pid in $(pgrep -f "node.*server.js"); do
  echo "PID $pid:"
  lsof -p $pid | grep cwd
done
# â†’ /Users/ksato/workspace/brainbase-ui ãŒã‚ã‚Œã°å•é¡Œ

# 3. launchdã‚µãƒ¼ãƒ“ã‚¹ãŒå‹•ã„ã¦ã„ãªã„ã‹ï¼Ÿ
launchctl list | grep brainbase
# â†’ com.brainbase.ui ãŒã‚ã‚Œã°OKï¼ˆlaunchdé‹ç”¨ï¼‰

# 4. å…¨åœæ­¢ã—ã¦å†èµ·å‹•
launchctl unload ~/Library/LaunchAgents/com.brainbase.ui.plist
pkill -9 -f "node.*server.js"
launchctl load ~/Library/LaunchAgents/com.brainbase.ui.plist
```

**é‡è¦**: brainbaseãƒªãƒã‚¸ãƒˆãƒªç§»å‹•å¾Œã¯ã€plistã®WorkingDirectory/PORT/BRAINBASE_ROOTã‚’æ›´æ–°ã—ã¦å†èª­ã¿è¾¼ã¿ã™ã‚‹

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
ã‚µãƒ¼ãƒãƒ¼ãŒé »ç¹ã«æ­»ã¬ â†’ ã€Œlaunchdè‡ªå‹•èµ·å‹•ãŒåŸå› ã‹?ã€
launchctl list ç¢ºèª â†’ com.brainbase.ui æ¤œå‡º
å†èª­ã¿è¾¼ã¿ â†’ æ­£ã—ã„è¨­å®šã§èµ·å‹•
```

---

## 2.3 package.jsonã®devã‚¹ã‚¯ãƒªãƒ—ãƒˆ - state.jsonç›£è¦–é™¤å¤–

**å•é¡Œ**: `node --watch server.js` ã¯ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å…¨ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆstate.jsonå«ã‚€ï¼‰ã‚’ç›£è¦–ã™ã‚‹

```bash
âŒ çµ¶å¯¾ã«ã‚„ã£ã¦ã¯ã„ã‘ãªã„ä¾‹
"dev": "node --watch server.js"

â†’ state.jsonå¤‰æ›´æ™‚ã«ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹•
â†’ StateStore.init()å®Ÿè¡Œ
â†’ æ—¢å­˜ã®state.jsonãŒä¸Šæ›¸ãã•ã‚Œã‚‹
â†’ ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ãŒæ¶ˆãˆã‚‹
```

```bash
âœ… æ­£ã—ã„ä¾‹: æ˜ç¤ºçš„ã«ç›£è¦–ãƒ‘ã‚¹ã‚’æŒ‡å®šã—ã¦state.jsonã‚’é™¤å¤–
"dev": "node --watch-path=server --watch-path=lib --watch-path=public --watch-path=server.js --watch-path=package.json --watch-preserve-output server.js"

â†’ state.jsonå¤‰æ›´æ™‚ã«å†èµ·å‹•ã—ãªã„
â†’ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ãŒä¿è­·ã•ã‚Œã‚‹
```

**åŸå› **:
- `--watch <file>` ã¯æŒ‡å®šãƒ•ã‚¡ã‚¤ãƒ«ã®ã¿ç›£è¦–
- `--watch server.js` ã¯ã‚«ãƒ¬ãƒ³ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªå…¨ä½“ã‚’ç›£è¦–ï¼ˆNode.jsã®ä»•æ§˜ï¼‰
- state.jsonã¯APIçµŒç”±ã§é »ç¹ã«æ›´æ–°ã•ã‚Œã‚‹
- å†èµ·å‹•ã®ãŸã³ã«StateStore.init()ãŒå®Ÿè¡Œã•ã‚Œã‚‹

**ç¢ºèªæ–¹æ³•**:
```bash
# package.jsonã®å†…å®¹ç¢ºèª
cat package.json | grep -A 1 '"dev"'

# æ­£ã—ã„è¨­å®šã«ãªã£ã¦ã„ã‚‹ã‹ç¢ºèª
grep "watch-path" package.json
```

**é‡è¦**: ã“ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã¯çµ¶å¯¾ã« `"dev": "node --watch server.js"` ã«æˆ»ã—ã¦ã¯ã„ã‘ãªã„

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
devã‚¹ã‚¯ãƒªãƒ—ãƒˆç·¨é›† â†’ ã€Œstate.jsonç›£è¦–é™¤å¤–ã•ã‚Œã¦ã„ã‚‹ã‹?ã€
ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ãŒæ¶ˆãˆã‚‹ â†’ devã‚¹ã‚¯ãƒªãƒ—ãƒˆç¢ºèª
```

---

# Â§ 3. launchdè‡ªå‹•èµ·å‹•ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

> **å‡ºå…¸**: brainbase-ui-launchd-gotchas (watchãƒ¢ãƒ¼ãƒ‰ç«¶åˆå•é¡Œ)

## 3.1 å•é¡Œã®ç—‡çŠ¶

- server.jsã‚’æ‰‹å‹•ã§ä¿®æ­£ãƒ»å†èµ·å‹•ã—ã¦ã‚‚å¤‰æ›´ãŒåæ˜ ã•ã‚Œãªã„
- æ—¥æœ¬èªãƒ•ã‚©ãƒ³ãƒˆç­‰ã®è¨­å®šå¤‰æ›´ãŒé©ç”¨ã•ã‚Œãªã„
- ãƒãƒ¼ãƒˆ31013ãŒæ—¢ã«ä½¿ç”¨ä¸­ã®ã‚¨ãƒ©ãƒ¼ãŒå‡ºã‚‹
- ãƒ—ãƒ­ã‚»ã‚¹ã‚’killã—ã¦ã‚‚è‡ªå‹•çš„ã«å†èµ·å‹•ã•ã‚Œã‚‹

## 3.2 æ ¹æœ¬åŸå› 

`com.brainbase.ui` ã¨ã„ã†launchdã‚µãƒ¼ãƒ“ã‚¹ãŒãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§å‹•ã„ã¦ãŠã‚Šã€è‡ªå‹•çš„ã«`npm run dev`ï¼ˆwatchãƒ¢ãƒ¼ãƒ‰ï¼‰ã‚’èµ·å‹•ã—ç¶šã‘ã¦ã„ã‚‹ã€‚

**å•é¡Œç‚¹ï¼š**
1. watchãƒ¢ãƒ¼ãƒ‰ã¯`--watch`ãƒ•ãƒ©ã‚°ã§ãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ã‚’ç›£è¦–ã—ã€è‡ªå‹•å†èµ·å‹•ã™ã‚‹
2. æ‰‹å‹•ã§èµ·å‹•ã—ãŸãƒ—ãƒ­ã‚»ã‚¹ã¨ç«¶åˆã™ã‚‹
3. watchãƒ¢ãƒ¼ãƒ‰ã¯å¤ã„ã‚³ãƒ¼ãƒ‰ã‚„ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ä½¿ã†å ´åˆãŒã‚ã‚‹
4. è¤‡æ•°ã®nodeãƒ—ãƒ­ã‚»ã‚¹ãŒåŒã˜ãƒãƒ¼ãƒˆã‚’å¥ªã„åˆã†

## 3.3 è¨ºæ–­æ–¹æ³•

### 1. launchdã‚µãƒ¼ãƒ“ã‚¹ã®ç¢ºèª

```bash
# brainbaseé–¢é€£ã®launchdã‚µãƒ¼ãƒ“ã‚¹ã‚’æ¤œç´¢
launchctl list | grep brainbase

# ç‰¹å®šã‚µãƒ¼ãƒ“ã‚¹ã®è©³ç´°ç¢ºèª
launchctl list com.brainbase.ui
```

### 2. å®Ÿè¡Œä¸­ã®nodeãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª

```bash
# brainbase-uié–¢é€£ã®nodeãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
ps aux | grep "node.*server.js"

# è¤‡æ•°ã®ãƒ—ãƒ­ã‚»ã‚¹ãŒå‹•ã„ã¦ã„ã‚‹å ´åˆã¯ç«¶åˆã®å¯èƒ½æ€§ã‚ã‚Š
```

### 3. ãƒãƒ¼ãƒˆä½¿ç”¨çŠ¶æ³ã®ç¢ºèª

```bash
# ãƒãƒ¼ãƒˆ31013ã‚’ä½¿ç”¨ã—ã¦ã„ã‚‹ãƒ—ãƒ­ã‚»ã‚¹ã‚’ç¢ºèª
lsof -i :31013
```

## 3.4 è§£æ±ºæ–¹æ³•

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: watch modeã®ãŸã‚ã«ä¸€æ™‚åœæ­¢

```bash
# ã‚µãƒ¼ãƒ“ã‚¹ã‚’åœæ­¢ï¼ˆä½œæ¥­ä¸­ã®ã¿ï¼‰
launchctl unload ~/Library/LaunchAgents/com.brainbase.ui.plist

# watch modeã§ä½œæ¥­ï¼ˆåˆ¥ãƒãƒ¼ãƒˆæ¨å¥¨ï¼‰
cd /Users/ksato/workspace/code/brainbase
PORT=31014 npm run dev

# ä½œæ¥­çµ‚äº†å¾Œã«å†é–‹
launchctl load ~/Library/LaunchAgents/com.brainbase.ui.plist
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: æ­£ã—ã„ã‚³ãƒãƒ³ãƒ‰ã«å¤‰æ›´

è‡ªå‹•èµ·å‹•ãŒå¿…è¦ãªå ´åˆã¯ã€plistãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã¦watchãƒ¢ãƒ¼ãƒ‰ã‚’ç„¡åŠ¹åŒ–ï¼š

```xml
<!-- å¤‰æ›´å‰ -->
<string>npm</string>
<string>run</string>
<string>dev</string>  <!-- ã“ã‚ŒãŒwatchãƒ¢ãƒ¼ãƒ‰ -->

<!-- å¤‰æ›´å¾Œ -->
<string>npm</string>
<string>start</string>  <!-- é€šå¸¸ãƒ¢ãƒ¼ãƒ‰ -->
```

å¤‰æ›´å¾Œã€ã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èª­ã¿è¾¼ã¿ï¼š

```bash
launchctl unload ~/Library/LaunchAgents/com.brainbase.ui.plist
launchctl load ~/Library/LaunchAgents/com.brainbase.ui.plist
```

## 3.5 æ­£ã—ã„èµ·å‹•æ–¹æ³•

### é–‹ç™ºæ™‚ï¼ˆwatch modeï¼‰

```bash
# watch modeï¼ˆåˆ¥ãƒãƒ¼ãƒˆï¼‰
cd /Users/ksato/workspace/code/brainbase
PORT=31014 npm run dev
```

### æ­£æœ¬ï¼ˆlaunchdé‹ç”¨ï¼‰

launchdã¯**å¿…ãš`npm start`ã‚’ä½¿ç”¨**ã—ã€watchãƒ¢ãƒ¼ãƒ‰ã¯é¿ã‘ã‚‹ã€‚

## 3.6 äºˆé˜²ç­–

1. **launchdã‚µãƒ¼ãƒ“ã‚¹ã‚’ä½œæˆã™ã‚‹å‰ã«ç¢ºèª**
   - æœ¬å½“ã«è‡ªå‹•èµ·å‹•ãŒå¿…è¦ã‹ï¼Ÿ
   - watchãƒ¢ãƒ¼ãƒ‰ã§ã¯ãªãé€šå¸¸ãƒ¢ãƒ¼ãƒ‰ã‹ï¼Ÿ
   - ãƒ­ã‚°å‡ºåŠ›å…ˆã¯é©åˆ‡ã‹ï¼Ÿ

2. **é–‹ç™ºæ™‚ã¯watch modeã‚’ãƒãƒ¼ãƒˆåˆ†é›¢**
   - launchdã¯ç¶­æŒï¼ˆPORT=31013ï¼‰
   - watch modeã¯ PORT=31014 ã§èµ·å‹•

3. **å®šæœŸçš„ã«launchdã‚µãƒ¼ãƒ“ã‚¹ã‚’ç¢ºèª**
   ```bash
   launchctl list | grep brainbase
   ```

## 3.7 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

ã‚µãƒ¼ãƒãƒ¼è¨­å®šå¤‰æ›´ãŒåæ˜ ã•ã‚Œãªã„å ´åˆï¼š

- [ ] `launchctl list | grep brainbase` ã§è‡ªå‹•èµ·å‹•ã‚µãƒ¼ãƒ“ã‚¹ã‚’ç¢ºèª
- [ ] `ps aux | grep "[n]ode.*server.js"` ã§è¤‡æ•°ãƒ—ãƒ­ã‚»ã‚¹ãŒãªã„ã‹ç¢ºèª
- [ ] launchdã‚µãƒ¼ãƒ“ã‚¹ã‚’å†èª­ã¿è¾¼ã¿
- [ ] ã™ã¹ã¦ã®nodeãƒ—ãƒ­ã‚»ã‚¹ã‚’kill: `pkill -9 -f "node.*server.js"`
- [ ] ã™ã¹ã¦ã®ttydãƒ—ãƒ­ã‚»ã‚¹ã‚’kill: `pkill -9 -f "ttyd"`
- [ ] launchdå†èµ·å‹•: `launchctl unload/load ~/Library/LaunchAgents/com.brainbase.ui.plist`
- [ ] watch modeã®å ´åˆ: `PORT=31014 npm run dev`
- [ ] ãƒ–ãƒ©ã‚¦ã‚¶ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã‚’ã‚¯ãƒªã‚¢ï¼ˆCmd+Shift+Rï¼‰

**æ•™è¨“:** watchãƒ¢ãƒ¼ãƒ‰ã¯é–‹ç™ºæ™‚ä¾¿åˆ©ã ãŒã€æ‰‹å‹•ãƒ‡ãƒãƒƒã‚°æ™‚ã¯ç«¶åˆã®åŸå› ã«ãªã‚‹ã€‚launchdã§ã®è‡ªå‹•èµ·å‹•ã¯æ…é‡ã«è¨­å®šã™ã‚‹ã“ã¨ã€‚

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
è¨­å®šå¤‰æ›´ãŒåæ˜ ã•ã‚Œãªã„ â†’ launchdçŠ¶æ…‹ç¢ºèª
launchdã‚µãƒ¼ãƒ“ã‚¹æ¤œå‡º â†’ å†èª­ã¿è¾¼ã¿
watch modeã¯PORTåˆ†é›¢ã§èµ·å‹•
```

---

# Â§ 4. ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†ãƒ«ãƒ¼ãƒ«

> **å‡ºå…¸**: brainbase-ui-version (å¤‰æ›´æ™‚ã®å¿…é ˆæ‰‹é †)

## 4.1 ãƒãƒ¼ã‚¸ãƒ§ãƒ³å½¢å¼

```
v0.0.0
```

- **v** ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹å¿…é ˆ
- **ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯ãƒãƒ¼ã‚¸ãƒ§ãƒ‹ãƒ³ã‚°**: MAJOR.MINOR.PATCH

## 4.2 ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ãƒ«ãƒ¼ãƒ«

brainbase-uiã®ã‚³ãƒ¼ãƒ‰ã‚’å¤‰æ›´ã—ãŸå ´åˆã€**å¿…ãšãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›´æ–°ã™ã‚‹**ã“ã¨ã€‚

### æ›´æ–°åŸºæº–

| å¤‰æ›´å†…å®¹ | ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–° | ä¾‹ |
|---------|--------------|-----|
| ç ´å£Šçš„å¤‰æ›´ | MAJOR | v0.1.0 â†’ v1.0.0 |
| æ–°æ©Ÿèƒ½è¿½åŠ  | MINOR | v0.1.0 â†’ v0.2.0 |
| ãƒã‚°ä¿®æ­£ãƒ»å°ã•ãªæ”¹å–„ | PATCH | v0.1.0 â†’ v0.1.1 |

### æ›´æ–°æ‰‹é †

1. **package.json ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›´æ–°**
   ```json
   {
     "version": "0.1.1"
   }
   ```

2. **index.html ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ›´æ–°ï¼ˆ2ç®‡æ‰€ï¼‰**
   - ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—ç‰ˆ: `<h3 id="app-version" class="app-version">v0.1.1</h3>`
   - ãƒ¢ãƒã‚¤ãƒ«ç‰ˆ: `<h3 id="mobile-app-version" class="mobile-version-display">v0.1.1</h3>`
   - **é‡è¦**: HTMLã«ç›´æ¥æ›¸ã‹ã‚Œã¦ã„ã‚‹ãŸã‚ã€ä¸¡æ–¹ã‚’æ‰‹å‹•ã§æ›´æ–°ã™ã‚‹ã“ã¨

3. **ã‚µãƒ¼ãƒãƒ¼ã‚’å†èµ·å‹•**
   ```bash
   # launchdã§å†èµ·å‹•ï¼ˆæ¨å¥¨ï¼‰
   launchctl unload /Users/ksato/Library/LaunchAgents/com.brainbase.ui.plist
   launchctl load /Users/ksato/Library/LaunchAgents/com.brainbase.ui.plist

   # watch modeã§èµ·å‹•ã™ã‚‹å ´åˆï¼ˆåˆ¥ãƒãƒ¼ãƒˆï¼‰
   cd /Users/ksato/workspace/code/brainbase
   PORT=31014 npm run dev
   ```

4. **ã‚³ãƒŸãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã«ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’å«ã‚ã‚‹**
   ```
   feat(ui): æ–°æ©Ÿèƒ½è¿½åŠ  (v0.1.1)

   ãªãœ:
   - å¤‰æ›´ç†ç”±

   ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

   Co-Authored-By: Claude Sonnet 4.5 <noreply@anthropic.com>
   ```

5. **UIã§ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª**
   - ãƒ‡ã‚¹ã‚¯ãƒˆãƒƒãƒ—: å·¦ãƒŠãƒ“æœ€ä¸Šéƒ¨ã«è¡¨ç¤º
   - ãƒ¢ãƒã‚¤ãƒ«: ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ã®ãƒ˜ãƒƒãƒ€ãƒ¼ã«è¡¨ç¤º
   - `/api/version` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã§å–å¾—å¯èƒ½

## 4.3 ãƒãƒ¼ã‚¸ãƒ§ãƒ³è¡¨ç¤ºã‚·ã‚¹ãƒ†ãƒ 

### å®Ÿè£…å ´æ‰€

- **package.json**: ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç•ªå·ã®æ­£æœ¬
- **server.js**: `/api/version` ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ
- **index.html**: `<span id="app-version">` è¦ç´ 
- **app.js**: `loadVersion()` é–¢æ•°
- **style.css**: `.app-version` ã‚¹ã‚¿ã‚¤ãƒ«

### ç¢ºèªæ–¹æ³•

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã§ç¢ºèª
curl http://localhost:31013/api/version

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ç¢ºèª
å·¦ãƒŠãƒ“ã®ã€ŒSessions v0.1.1ã€ã‚’ç›®è¦–ç¢ºèª
```

## 4.4 æ³¨æ„äº‹é …

- ãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ãªã—ã§ã®å¤‰æ›´ã¯**ç¦æ­¢**
- ãƒ–ãƒ©ã‚¦ã‚¶ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã«æ³¨æ„ï¼ˆã‚¹ãƒ¼ãƒ‘ãƒ¼ãƒªãƒ­ãƒ¼ãƒ‰: Cmd+Shift+Rï¼‰
- è¤‡æ•°ã®å¤‰æ›´ãŒã‚ã‚‹å ´åˆã¯ã€æœ€ã‚‚å¤§ããªå¤‰æ›´ã«åˆã‚ã›ã¦ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚’æ±ºå®š

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
brainbase-uiå¤‰æ›´ â†’ ã€Œãƒãƒ¼ã‚¸ãƒ§ãƒ³æ›´æ–°ãŒå¿…è¦ã€
package.json + index.html(2ç®‡æ‰€) æ›´æ–°
ã‚µãƒ¼ãƒãƒ¼å†èµ·å‹• â†’ ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèª
```

---

# Â§ 5. GitHub Actionsç®¡ç†

> **å‡ºå…¸**: github-actions-management (ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ç®¡ç†ãƒ«ãƒ¼ãƒ«)

## 5.1 å¿…é ˆã‚¢ã‚¯ã‚·ãƒ§ãƒ³

### ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä½œæˆæ™‚

1. **ç®¡ç†ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‚’æ›´æ–°**: `_codex/common/ops/scheduled-jobs.md`
   - ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œã®å ´åˆ: ã€Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«å®Ÿè¡Œã€ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ 
   - ã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒªã‚¬ãƒ¼ã®å ´åˆ: ã€Œã‚¤ãƒ™ãƒ³ãƒˆãƒˆãƒªã‚¬ãƒ¼å®Ÿè¡Œã€ãƒ†ãƒ¼ãƒ–ãƒ«ã«è¿½åŠ 
   - å¿…è¦ãªSecretsãŒã‚ã‚Œã°ã€Œå¿…è¦ãªSecretsã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«è¿½åŠ 

2. **ãƒ©ãƒ³ãƒŠãƒ¼é¸æŠåŸºæº–**:
   - `ubuntu-latest`ï¼ˆã‚¯ãƒ©ã‚¦ãƒ‰ï¼‰: å¤–éƒ¨APIå‘¼ã³å‡ºã—ã®ã¿ã§å®Œçµã™ã‚‹ã‚¸ãƒ§ãƒ–
   - `[self-hosted, local]`ï¼ˆã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆï¼‰: ãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹ãŒå¿…è¦ãªã‚¸ãƒ§ãƒ–

### è¨˜è¼‰é …ç›®

| é …ç›® | å†…å®¹ |
|------|------|
| ã‚¸ãƒ§ãƒ–å | ã‚ã‹ã‚Šã‚„ã™ã„æ—¥æœ¬èªå |
| ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ« | JSTè¡¨è¨˜ï¼ˆä¾‹: æ¯æ—¥ 21:00 JSTï¼‰ |
| ç›®çš„ | ä½•ã‚’ã™ã‚‹ã‹ç°¡æ½”ã« |
| ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | `.github/workflows/xxx.yml` |
| ãƒ©ãƒ³ãƒŠãƒ¼ | ubuntu-latest ã¾ãŸã¯ self-hosted |

## 5.2 ä¾‹

```markdown
| manaæ—¥æ¬¡å‡¦ç† | æ¯æ—¥ 21:00 JST | Airtableã‚¹ãƒ—ãƒªãƒ³ãƒˆã«æ—¥æ¬¡ãƒ­ã‚°è¿½è¨˜ | `.github/workflows/mana-daily.yml` | ubuntu-latest |
```

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä½œæˆ â†’ ã€Œscheduled-jobs.mdæ›´æ–°ãŒå¿…è¦ã€
ãƒ©ãƒ³ãƒŠãƒ¼é¸æŠ â†’ ã€Œãƒ­ãƒ¼ã‚«ãƒ«ãƒ•ã‚¡ã‚¤ãƒ«ã‚¢ã‚¯ã‚»ã‚¹å¿…è¦ï¼Ÿã€
  â†’ Yes: self-hosted
  â†’ No: ubuntu-latest
```

---

# Â§ 6. worktreeé–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•

> **å‡ºå…¸**: worktree-dev-server (ãƒãƒ¼ãƒˆç«¶åˆå›é¿)

## 6.1 æ‰‹é †

### 1. ãƒãƒ¼ãƒˆç¢ºèª
```bash
lsof -i :31013 -i :31014 -i :31015 -i :31016 2>/dev/null | grep LISTEN
```

ä½¿ç”¨ã•ã‚Œã¦ã„ãªã„æœ€å°ã®ãƒãƒ¼ãƒˆã‚’é¸æŠï¼ˆ31014ã‹ã‚‰é–‹å§‹ã€31013ã¯æ­£æœ¬ç”¨ï¼‰

### 2. ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆnode_modulesãŒãªã„å ´åˆï¼‰
```bash
cd [ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª] && npm install
```

### 3. é–‹ç™ºã‚µãƒ¼ãƒãƒ¼èµ·å‹•
```bash
PORT=[ç©ºããƒãƒ¼ãƒˆ] npm run dev
```

ãƒãƒƒã‚¯ã‚°ãƒ©ã‚¦ãƒ³ãƒ‰ã§èµ·å‹•ã™ã‚‹å ´åˆã¯ `run_in_background: true` ã‚’ä½¿ç”¨

## 6.2 ãƒãƒ¼ãƒˆå‰²ã‚Šå½“ã¦ãƒ«ãƒ¼ãƒ«

| ãƒãƒ¼ãƒˆ | ç”¨é€” |
|--------|------|
| 31013 | æ­£æœ¬ï¼ˆmainï¼‰ã®é–‹ç™ºã‚µãƒ¼ãƒãƒ¼ |
| 31014ã€œ | worktreeç”¨ï¼ˆç«¶åˆæ™‚ã¯æ¬¡ã®ãƒãƒ¼ãƒˆã‚’ä½¿ç”¨ï¼‰ |

## 6.3 ä¾‹

```bash
# ãƒãƒ¼ãƒˆç¢ºèª
lsof -i :31014 2>/dev/null | grep LISTEN

# ç©ºã„ã¦ã„ã‚Œã°èµ·å‹•
cd /Users/ksato/workspace/shared/.worktrees/session-xxx-brainbase/code/brainbase && npm install && PORT=31014 npm run dev
```

## 6.4 æ³¨æ„äº‹é …

- worktreeã§ã¯å¿…ãšãƒãƒ¼ãƒˆ31013ä»¥å¤–ã‚’ä½¿ç”¨
- node_modulesã¯worktreeã”ã¨ã«ç‹¬ç«‹ï¼ˆã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã§ã¯ãªã„ï¼‰
- èµ·å‹•å¾Œã¯BashOutputã§çŠ¶æ…‹ã‚’ç¢ºèª

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
worktreeã§é–‹ç™º â†’ ã€Œãƒãƒ¼ãƒˆ31013ä»¥å¤–ã‚’ä½¿ç”¨ã€
lsof ã§ç©ºããƒãƒ¼ãƒˆç¢ºèª â†’ PORT=31014 npm run dev
```

---

# Â§ 7. ç’°å¢ƒå¤‰æ•°ç®¡ç†

> **å‡ºå…¸**: env-management (æ­£æœ¬ç®¡ç†ã¨åŒæœŸæ‰‹é †)

## 7.1 åŸºæœ¬æ–¹é‡

**ç®¡ç†å ´æ‰€ã‚’ç”¨é€”åˆ¥ã«åˆ†é›¢** - ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ¬ãƒ™ãƒ«ã¨ä½¿ç”¨å ´æ‰€ã«å¿œã˜ã¦ç®¡ç†å ´æ‰€ã‚’æ˜ç¢ºåŒ–

| ã‚«ãƒ†ã‚´ãƒª | ç®¡ç†å ´æ‰€ | ä¾‹ |
|---------|---------|-----|
| **ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºå°‚ç”¨** | `.env`ã®ã¿ | `AWS_PROFILE`, `HOME` |
| **CI/CDå°‚ç”¨** | GitHub Secretsã®ã¿ | `AWS_ACCESS_KEY_ID`, `ACTIONS_MONITOR_PAT` |
| **å…±é€šï¼ˆåŒæœŸå¿…è¦ï¼‰** | `.env` + GitHub Secrets | `AIRTABLE_TOKEN`, `SLACK_BOT_TOKEN` |
| **Lambdaå°‚ç”¨** | Lambdaç’°å¢ƒå¤‰æ•°ã®ã¿ | `DEDUP_TABLE_NAME`, `PROJECTS_TABLE_NAME` |
| **å…¨ç’°å¢ƒå…±é€š** | `.env` + GitHub Secrets + Lambda | `GITHUB_TOKEN`, `GMAIL_CLIENT_ID` |

**åŸå‰‡**:
- âœ… `.env` = ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã®æ­£æœ¬ï¼ˆ214è¡Œã€66å¤‰æ•°ï¼‰
- âœ… GitHub Secrets = CI/CDç”¨ã®æ©Ÿå¯†æƒ…å ±ï¼ˆ10å¤‰æ•°ï¼‰
- âœ… Lambdaç’°å¢ƒå¤‰æ•° = å®Ÿè¡Œæ™‚ã®è¨­å®šï¼ˆ20-25å¤‰æ•°ï¼‰
- âš ï¸ å®Œå…¨ãªä¸€å…ƒç®¡ç†ã§ã¯ãªãã€**ç®¡ç†å ´æ‰€ã®æ˜ç¢ºåŒ–**ã‚’é‡è¦–

### ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆ

```
/Users/ksato/workspace/shared/
â”œâ”€â”€ .env                          # ğŸ”‘ ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç”¨æ­£æœ¬ï¼ˆ214è¡Œï¼‰
â”œâ”€â”€ .env.bak.YYYYMMDD             # ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
â”œâ”€â”€ _codex/common/ops/
â”‚   â”œâ”€â”€ env-management-plan.md         # è©³ç´°ãƒ—ãƒ©ãƒ³
â”‚   â””â”€â”€ aws-lambda-env-update.md       # Lambdaæ›´æ–°æ¨™æº–
```

**æ³¨**: åŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆsync-env-to-github.shç­‰ï¼‰ã¯æœªå®Ÿè£…ã€‚æ‰‹å‹•åŒæœŸã®ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆã§é‹ç”¨ã€‚

---

## 7.2 å‘½åè¦å‰‡

### ãƒãƒ«ãƒãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹Slack

```bash
# ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åˆ¥ã«åˆ†é›¢
SLACK_BOT_TOKEN_UNSON=xoxb-XXX
SLACK_BOT_TOKEN_SALESTAILOR=xoxb-XXX
SLACK_BOT_TOKEN_TECHKNIGHT=xoxb-XXX

# é–¢é€£å¤‰æ•°ã‚‚åŒæ§˜
SLACK_SIGNING_SECRET_UNSON=XXX
SLACK_BOT_ID_UNSON=BXXX
INBOX_TARGET_USER_ID_UNSON=UXXX

# ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆï¼ˆå¾Œæ–¹äº’æ›æ€§ï¼‰
SLACK_BOT_TOKEN=xoxb-XXX  # UNSON
SLACK_SIGNING_SECRET=XXX  # UNSON
```

### Airtableï¼ˆå‘½åçµ±ä¸€ï¼‰

```bash
# æ­£å¼åç§°ï¼ˆLambdaæ¨™æº–ï¼‰
AIRTABLE_TOKEN=patXXX...

# å¾Œæ–¹äº’æ›æ€§ï¼ˆGitHub Actionsã€å¤ã„ã‚¹ã‚¯ãƒªãƒ—ãƒˆç”¨ï¼‰
AIRTABLE_API_KEY=patXXX...  # åŒã˜å€¤
```

**ç†ç”±**: Airtableã®Personal Access Tokenã¯1ç¨®é¡ã®ã¿ã€‚TOKENã¨API_KEYã¯åŒã˜ã‚‚ã®ã‚’æŒ‡ã™ã€‚

### ãã®ä»–ã®API

```bash
# Google
GOOGLE_API_KEY=AIzaSyXXX

# X (Twitter)
X_CONSUMER_KEY=XXX
X_CONSUMER_SECRET=XXX
X_ACCESS_TOKEN=XXX
X_ACCESS_TOKEN_SECRET=XXX

# Gmail
GMAIL_CLIENT_ID=XXX
GMAIL_CLIENT_SECRET=XXX
GMAIL_REFRESH_TOKEN=XXX

# GitHub
GITHUB_TOKEN=ghp_XXX

# AWSï¼ˆãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼‰
AWS_PROFILE=k.sato
AWS_REGION=us-east-1
```

---

## 7.3 .envæ§‹æˆï¼ˆçµ±ä¸€ç‰ˆï¼‰

214è¡Œã€66å€‹ã®ç’°å¢ƒå¤‰æ•°ã‚’å«ã‚€å®Œå…¨ç‰ˆã€‚ã‚»ã‚¯ã‚·ãƒ§ãƒ³æ§‹æˆï¼š

```bash
# ========================================
# Google APIs
# ========================================
GOOGLE_API_KEY=XXX

# ========================================
# X (Twitter) APIs
# ========================================
X_CONSUMER_KEY=XXX
X_CONSUMER_SECRET=XXX
...

# ========================================
# Slackï¼ˆãƒãƒ«ãƒãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹å¯¾å¿œï¼‰
# ========================================
SLACK_BOT_TOKEN_UNSON=XXX
SLACK_BOT_TOKEN_SALESTAILOR=XXX
SLACK_BOT_TOKEN_TECHKNIGHT=XXX
SLACK_BOT_TOKEN=XXX  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
...

# ========================================
# Airtable
# ========================================
AIRTABLE_TOKEN=XXX
AIRTABLE_API_KEY=XXX  # ã‚¨ã‚¤ãƒªã‚¢ã‚¹
...

# ========================================
# DynamoDBï¼ˆmanaç”¨ï¼‰
# ========================================
DEDUP_TABLE_NAME=mana-processed-events
PROJECTS_TABLE_NAME=mana-projects

# ========================================
# ãã®ä»–ï¼ˆGmail, Jibble, Mistral, n8n, Tavilyï¼‰
# ========================================
...
```

---

## 7.4 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

### æ–°è¦ç’°å¢ƒå¤‰æ•°è¿½åŠ æ™‚

- [ ] .envã«è¿½åŠ ï¼ˆé©åˆ‡ãªã‚»ã‚¯ã‚·ãƒ§ãƒ³ã«ï¼‰
- [ ] ã‚³ãƒ¡ãƒ³ãƒˆã§ç”¨é€”ã‚’æ˜è¨˜
- [ ] GitHub Secretsã«åŒæœŸï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
- [ ] Lambdaç’°å¢ƒå¤‰æ•°ã«åŒæœŸï¼ˆå¿…è¦ã«å¿œã˜ã¦ï¼‰
- [ ] æ—¢å­˜ã‚³ãƒ¼ãƒ‰ã§å‚ç…§å¯èƒ½ã‹ç¢ºèª

### .envæ›´æ–°æ™‚

- [ ] ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆï¼ˆ`.env.bak.YYYYMMDD`ï¼‰
- [ ] å¤‰æ›´å†…å®¹ã‚’ç¢ºèª
- [ ] ãƒ†ã‚¹ãƒˆã‚¹ã‚¯ãƒªãƒ—ãƒˆã§å‹•ä½œç¢ºèª
- [ ] æ´¾ç”Ÿç’°å¢ƒã«åŒæœŸï¼ˆGitHub Secrets/Lambdaï¼‰

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
ç’°å¢ƒå¤‰æ•°è¿½åŠ  â†’ ã€Œã©ã®ç’°å¢ƒã§ä½¿ã†ã‹?ã€
  â†’ ãƒ­ãƒ¼ã‚«ãƒ«ã®ã¿: .envã®ã¿
  â†’ CI/CD: GitHub SecretsåŒæœŸ
  â†’ Lambda: Lambdaç’°å¢ƒå¤‰æ•°åŒæœŸ
  â†’ å…¨ç’°å¢ƒ: å…¨ã¦åŒæœŸ
```

---

## 7.5 ç’°å¢ƒå¤‰æ•°ã®èª­ã¿è¾¼ã¿æ–¹æ³•

### ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºï¼ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œæ™‚ï¼‰

**æ¨å¥¨**: ç’°å¢ƒå¤‰æ•°ã‚’ç›´æ¥æŒ‡å®š
```bash
SLACK_BOT_TOKEN="$(grep '^SLACK_BOT_TOKEN=' .env | head -1 | cut -d'=' -f2)" \
AIRTABLE_API_KEY="$(grep '^AIRTABLE_API_KEY=' .env | cut -d'=' -f2)" \
node _codex/common/ops/scripts/mana-m9-weekly-milestone.js
```

**ç°¡æ˜“ç‰ˆ**: sourceã‚³ãƒãƒ³ãƒ‰ï¼ˆå¤‰æ•°å±•é–‹ã¯ä½¿ãˆãªã„ï¼‰
```bash
set -a
source /Users/ksato/workspace/.env
set +a
node script.js
```

### GitHub Actions

```yaml
jobs:
  my-job:
    runs-on: [self-hosted, local]
    steps:
      - name: Load environment variables
        run: |
          set -a
          source /Users/ksato/workspace/.env
          set +a

      - name: Run script
        run: node _codex/common/ops/scripts/mana-m1-morning-brief.js
```

### Lambdaï¼ˆç’°å¢ƒå¤‰æ•°è¨­å®šæ¸ˆã¿ï¼‰

Lambdaé–¢æ•°ã«ã¯æ—¢ã«ç’°å¢ƒå¤‰æ•°ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹ãŸã‚ã€ã‚³ãƒ¼ãƒ‰ã‹ã‚‰ç›´æ¥å‚ç…§ï¼š
```javascript
const token = process.env.SLACK_BOT_TOKEN;
const airtableKey = process.env.AIRTABLE_TOKEN || process.env.AIRTABLE_API_KEY;
```

---

## 7.6 GitHub Secretsã¨ã®å¯¾å¿œé–¢ä¿‚

### âœ… .envã«å€¤ãŒã‚ã‚‹å¤‰æ•°ï¼ˆåŒæœŸæ¸ˆã¿: 4/10ï¼‰

| GitHub Secret | .envã§ã®åå‰ | ç”¨é€” | ç®¡ç†å ´æ‰€ |
|--------------|-------------|------|---------|
| `AIRTABLE_API_KEY` | `AIRTABLE_TOKEN` | Airtable API | ä¸¡æ–¹ |
| `SLACK_BOT_TOKEN` | `SLACK_BOT_TOKEN_UNSON` | Slack Botï¼ˆUNSONï¼‰ | ä¸¡æ–¹ |
| `X_CLIENT_ID` | `X_CLIENT_ID` | X OAuth 2.0 | ä¸¡æ–¹ |
| `X_CLIENT_SECRET` | `X_CLIENT_SECRET` | X OAuth 2.0 | ä¸¡æ–¹ |

### âŒ GitHub Secretsã®ã¿ã«å­˜åœ¨ï¼ˆ.envã«ã¯å€¤ãªã—: 6/10ï¼‰

| GitHub Secret | .envã®çŠ¶æ…‹ | ç”¨é€” | ç†ç”± |
|--------------|-----------|------|------|
| `ACTIONS_MONITOR_PAT` | ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ | GitHub Actionsç›£è¦–ç”¨ | CI/CDå°‚ç”¨ |
| `AWS_ACCESS_KEY_ID` | ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ | Lambda CI/CDç”¨ | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ |
| `AWS_SECRET_ACCESS_KEY` | ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ | Lambda CI/CDç”¨ | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ |
| `SLACK_CHANNEL_ID` | ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ | Actionsé€šçŸ¥å…ˆ | CI/CDå°‚ç”¨ |
| `X_OAUTH_TOKEN` | ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ | X OAuth 2.0ãƒˆãƒ¼ã‚¯ãƒ³ | å‹•çš„æ›´æ–° |
| `X_TOKEN_KEY` | ã‚³ãƒ¡ãƒ³ãƒˆã®ã¿ | Xèªè¨¼ç”¨ | å‹•çš„æ›´æ–° |

**æ–¹é‡**:
- CI/CDå°‚ç”¨ã®å¤‰æ•°ã¯GitHub Secretsã®ã¿ã§ç®¡ç†ï¼ˆ.envã«è¿½åŠ ã—ãªã„ï¼‰
- ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ä¸Šã®ç†ç”±ã§ãƒ­ãƒ¼ã‚«ãƒ«.envã«å«ã‚ãªã„å¤‰æ•°ã‚‚å­˜åœ¨
- å‹•çš„ã«æ›´æ–°ã•ã‚Œã‚‹å¤‰æ•°ï¼ˆOAuth Tokenç­‰ï¼‰ã¯GitHub SecretsãŒæ­£æœ¬

---

## 7.7 åŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆï¼ˆæœªå®Ÿè£…ï¼‰

### GitHub Secrets åŒæœŸ

`_codex/common/ops/scripts/sync-env-to-github.sh`:
```bash
#!/bin/bash
# .env â†’ GitHub Secrets åŒæœŸ

ENV_FILE="/Users/ksato/workspace/.env"
REPO="Unson-LLC/brainbase"

SYNC_VARS=(
  "AIRTABLE_TOKEN"
  "SLACK_BOT_TOKEN_UNSON"
  "AWS_ACCESS_KEY_ID"
  "AWS_SECRET_ACCESS_KEY"
  "GITHUB_TOKEN"
)

for var in "${SYNC_VARS[@]}"; do
  value=$(grep "^${var}=" "$ENV_FILE" | cut -d '=' -f2)
  echo "$value" | gh secret set "$var" --repo "$REPO"
done
```

### Lambda åŒæœŸ

`_codex/common/ops/scripts/sync-env-to-lambda.sh`:
```bash
#!/bin/bash
# .env â†’ Lambda ç’°å¢ƒå¤‰æ•°åŒæœŸ

LAMBDA_FUNCTION="mana"
AWS_PROFILE="k.sato"

# ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—
aws lambda get-function-configuration \
  --function-name "$LAMBDA_FUNCTION" \
  --profile "$AWS_PROFILE" \
  --query 'Environment' > /tmp/lambda_env_backup.json

# .envã‹ã‚‰èª­ã¿è¾¼ã¿ã€JSONç”Ÿæˆã—ã¦update
# (è©³ç´°ã¯_codex/common/ops/aws-lambda-env-update.mdå‚ç…§)
```

---

## 7.8 ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ: ç’°å¢ƒå¤‰æ•°ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„

**åŸå› **: `source .env`ã§å¤‰æ•°å±•é–‹ï¼ˆ`${VAR}`å½¢å¼ï¼‰ãŒå‹•ä½œã—ãªã„

**è§£æ±º**: .envãƒ•ã‚¡ã‚¤ãƒ«ã®ã‚¨ã‚¤ãƒªã‚¢ã‚¹å¤‰æ•°ã«ç›´æ¥å€¤ã‚’ã‚³ãƒ”ãƒ¼
```bash
# âŒ å‹•ä½œã—ãªã„
SLACK_BOT_TOKEN=${SLACK_BOT_TOKEN_UNSON}

# âœ… å‹•ä½œã™ã‚‹
SLACK_BOT_TOKEN=xoxb-7700200993749-XXX
```

### å•é¡Œ: AIRTABLE_API_KEY vs AIRTABLE_TOKEN

**åŸå› **: åŒã˜ã‚‚ã®ã‚’æŒ‡ã™2ã¤ã®å¤‰æ•°åãŒæ··åœ¨

**è§£æ±º**: ä¸¡æ–¹ã«åŒã˜å€¤ã‚’è¨­å®šï¼ˆå¾Œæ–¹äº’æ›æ€§ç¶­æŒï¼‰
```bash
AIRTABLE_TOKEN=patXXX...
AIRTABLE_API_KEY=patXXX...  # åŒã˜å€¤
```

manaã‚³ãƒ¼ãƒ‰ã¯æ—¢ã«ä¸¡æ–¹ã«å¯¾å¿œï¼š
```javascript
// mana/api/airtable-mcp-client.js
const AIRTABLE_API_KEY = process.env.AIRTABLE_API_KEY || process.env.AIRTABLE_TOKEN;
```

### å•é¡Œ: ãƒãƒ«ãƒãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹Slackãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†

**è§£æ±º**: ãƒ¯ãƒ¼ã‚¯ã‚¹ãƒšãƒ¼ã‚¹åˆ¥ã«åˆ†é›¢ã—ã€ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã‚’è¨­å®š
```bash
SLACK_BOT_TOKEN_UNSON=xoxb-XXX
SLACK_BOT_TOKEN_SALESTAILOR=xoxb-XXX
SLACK_BOT_TOKEN_TECHKNIGHT=xoxb-XXX
SLACK_BOT_TOKEN=xoxb-XXX  # ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ=UNSON
```

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
ç’°å¢ƒå¤‰æ•°ã‚¨ãƒ©ãƒ¼ â†’ ã€Œå¤‰æ•°å±•é–‹ãŒåŸå› ã‹?ã€
ç›´æ¥å€¤ã‚’ã‚³ãƒ”ãƒ¼ â†’ å‹•ä½œç¢ºèª

Airtableã‚¨ãƒ©ãƒ¼ â†’ ã€ŒAIRTABLE_API_KEY vs AIRTABLE_TOKENã€
ä¸¡æ–¹ã«åŒã˜å€¤è¨­å®š â†’ å¾Œæ–¹äº’æ›æ€§ç¢ºä¿
```

---

# Troubleshooting

## å•é¡Œ1: HooksãŒå‹•ä½œã—ãªã„

**ç—‡çŠ¶**:
- sessionStartãŒç™ºç«ã—ãªã„
- stopãƒˆãƒªã‚¬ãƒ¼ãŒå‹•ä½œã—ãªã„

**åŸå› **:
- JSONæ§‹é€ ãŒ `{"hooks": {...}}` ã«ãªã£ã¦ã„ãªã„
- ã‚³ãƒãƒ³ãƒ‰ãƒ‘ã‚¹ãŒç›¸å¯¾ãƒ‘ã‚¹

**å¯¾å‡¦**:
1. `cat ~/.config/claude-code/settings.json | jq '.hooks'` ã§æ§‹é€ ç¢ºèª
2. ãƒã‚¹ãƒˆæ§‹é€ ã«ä¿®æ­£
3. ã‚³ãƒãƒ³ãƒ‰ãƒ‘ã‚¹ã‚’çµ¶å¯¾ãƒ‘ã‚¹ã«å¤‰æ›´

---

## å•é¡Œ2: ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãªã„

**ç—‡çŠ¶**:
- ãƒãƒ¼ãƒˆ31013ãŒæ—¢ã«ä½¿ç”¨ä¸­
- è¤‡æ•°ã®nodeãƒ—ãƒ­ã‚»ã‚¹ãŒå‹•ã„ã¦ã„ã‚‹

**åŸå› **:
- è¤‡æ•°ã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹èµ·å‹•ã«ã‚ˆã‚‹StateStoreç«¶åˆ
- launchdè‡ªå‹•èµ·å‹•ãŒå‹•ã„ã¦ã„ã‚‹

**å¯¾å‡¦**:
1. `ps aux | grep "[n]ode.*server.js"` ã§ç¢ºèª
2. `pkill -f "node.*server.js"` ã§å…¨åœæ­¢
3. `launchctl list | grep brainbase` ã§è‡ªå‹•èµ·å‹•ç¢ºèª
4. launchdã‚µãƒ¼ãƒ“ã‚¹ãŒã‚ã‚Œã°å†èª­ã¿è¾¼ã¿
5. `launchctl unload/load ~/Library/LaunchAgents/com.brainbase.ui.plist` ã§èµ·å‹•

---

## å•é¡Œ3: ã‚»ãƒƒã‚·ãƒ§ãƒ³å±¥æ­´ãŒæ¶ˆãˆã‚‹

**ç—‡çŠ¶**:
- state.jsonãŒç©ºã«ãªã‚‹
- ã‚»ãƒƒã‚·ãƒ§ãƒ³ä¸€è¦§ãŒ0ä»¶

**åŸå› **:
- devã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒstate.jsonã‚’ç›£è¦–ã—ã¦ã„ã‚‹
- BRAINBASE_ROOTå®šç¾©ãŒå‰Šé™¤ã•ã‚Œã¦ã„ã‚‹

**å¯¾å‡¦**:
1. `grep "watch-path" package.json` ã§ç›£è¦–ãƒ‘ã‚¹ç¢ºèª
2. state.jsoné™¤å¤–ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
3. `grep "BRAINBASE_ROOT" server.js` ã§å®šç¾©ç¢ºèª
4. å®šç¾©ãŒå‰Šé™¤ã•ã‚Œã¦ã„ãŸã‚‰è¿½åŠ 

---

## å•é¡Œ4: ç’°å¢ƒå¤‰æ•°ãŒèª­ã¿è¾¼ã¾ã‚Œãªã„

**ç—‡çŠ¶**:
- SLACK_BOT_TOKEN undefined
- AIRTABLE_API_KEY undefined

**åŸå› **:
- å¤‰æ•°å±•é–‹ï¼ˆ${VAR}å½¢å¼ï¼‰ãŒå‹•ä½œã—ãªã„
- å‘½åä¸æ•´åˆï¼ˆAIRTABLE_API_KEY vs AIRTABLE_TOKENï¼‰

**å¯¾å‡¦**:
1. `.env` ã§å¤‰æ•°å±•é–‹ã‚’ç›´æ¥å€¤ã«ã‚³ãƒ”ãƒ¼
2. AIRTABLE_TOKEN ã¨ AIRTABLE_API_KEY ä¸¡æ–¹ã«åŒã˜å€¤è¨­å®š
3. `source .env` ã§ãƒ†ã‚¹ãƒˆ

---

## å•é¡Œ5: worktreeã§ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ãªã„

**ç—‡çŠ¶**:
- ãƒãƒ¼ãƒˆç«¶åˆã‚¨ãƒ©ãƒ¼
- node_modulesãŒãªã„

**åŸå› **:
- ãƒãƒ¼ãƒˆ31013ãŒæ­£æœ¬ã§ä½¿ç”¨ä¸­
- worktreeã§ä¾å­˜é–¢ä¿‚æœªã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

**å¯¾å‡¦**:
1. `lsof -i :3001` ã§ç©ºããƒãƒ¼ãƒˆç¢ºèª
2. `npm install` ã§ä¾å­˜é–¢ä¿‚ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
3. `PORT=31014 npm run dev` ã§èµ·å‹•

---

# Â§ 8. Branch & Worktreeé‹ç”¨

> **å‡ºå…¸**: branch-worktree-rules (æ­£æœ¬ç®¡ç†ã¨ã‚³ãƒŸãƒƒãƒˆå…ˆåˆ†é›¢)

## 8.1 åŸºæœ¬åŸå‰‡

**ãƒ•ã‚¡ã‚¤ãƒ«ã®æ€§è³ªã«ã‚ˆã£ã¦ã‚³ãƒŸãƒƒãƒˆå…ˆã‚’åˆ†é›¢ã™ã‚‹:**

| ãƒ•ã‚¡ã‚¤ãƒ«ç¨®åˆ¥ | æ€§è³ª | ã‚³ãƒŸãƒƒãƒˆå…ˆ |
|-------------|------|------------|
| æ­£æœ¬ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å…±æœ‰ | mainç›´æ¥ |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ | ãƒ–ãƒ©ãƒ³ãƒã”ã¨ã«ç•°ãªã‚Šã†ã‚‹ | ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ–ãƒ©ãƒ³ãƒ |

---

## 8.2 æ­£æœ¬ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å®šç¾©

ä»¥ä¸‹ã¯ã€Œæ­£æœ¬ã€ã¨ã—ã¦ã€å…¨worktreeã§å…±æœ‰ã•ã‚Œã‚‹ï¼š

```
/Users/ksato/workspace/
â”œâ”€â”€ _codex/          # ãƒŠãƒ¬ãƒƒã‚¸æ­£æœ¬
â”œâ”€â”€ _tasks/          # ã‚¿ã‚¹ã‚¯æ­£æœ¬
â”œâ”€â”€ _inbox/          # å—ä¿¡ç®±
â”œâ”€â”€ _schedules/      # ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«
â”œâ”€â”€ _ops/            # å…±é€šã‚¹ã‚¯ãƒªãƒ—ãƒˆ
â”œâ”€â”€ .claude/         # Claudeè¨­å®šãƒ»Skills
â””â”€â”€ config.yml       # è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«
```

**æ­£æœ¬ã®ç‰¹å¾´:**
- å¸¸ã«æœ€æ–°ã‚’å…¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å…±æœ‰ã—ãŸã„
- ãƒ–ãƒ©ãƒ³ãƒåˆ†å²ã®å¯¾è±¡ã§ã¯ãªã„
- mainã«ç›´æ¥ã‚³ãƒŸãƒƒãƒˆã™ã‚‹

---

## 8.3 Worktreeæ§‹é€ ï¼ˆã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯æ–¹å¼ï¼‰

worktreeä½œæˆæ™‚ã€æ­£æœ¬ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã§æ­£æœ¬ãƒ‘ã‚¹ã‚’å‚ç…§ï¼š

```
/Users/ksato/workspace/shared/.worktrees/session-xxx-brainbase/
â”œâ”€â”€ _codex -> /Users/ksato/workspace/shared/_codex      # ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
â”œâ”€â”€ _tasks -> /Users/ksato/workspace/shared/_tasks      # ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
â”œâ”€â”€ _inbox -> /Users/ksato/workspace/shared/_inbox      # ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯
â”œâ”€â”€ _schedules -> /Users/ksato/workspace/shared/_schedules
â”œâ”€â”€ _ops -> /Users/ksato/workspace/shared/_ops
â”œâ”€â”€ .claude -> /Users/ksato/workspace/shared/.claude
â”œâ”€â”€ config.yml -> /Users/ksato/workspace/shared/config.yml
â”œâ”€â”€ CLAUDE.md                                     # å®Ÿãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå„worktreeã«å­˜åœ¨ï¼‰
â”œâ”€â”€ code/
â”‚   â””â”€â”€ brainbase/                               # å®Ÿãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ–ãƒ©ãƒ³ãƒãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
â””â”€â”€ projects/                                    # å®Ÿãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆãƒ–ãƒ©ãƒ³ãƒãƒ­ãƒ¼ã‚«ãƒ«ï¼‰
```

**ãƒ¡ãƒªãƒƒãƒˆ:**
- ã©ã®worktreeã‹ã‚‰ã§ã‚‚åŒã˜æ­£æœ¬ã‚’ç·¨é›†
- æ­£æœ¬ã®å¤‰æ›´ã¯mainã«è‡ªå‹•çš„ã«å±ã™ã‚‹
- ãƒ‘ã‚¹è§£æ±ºã®æ··ä¹±ãŒãªã„

---

## 8.4 ã‚³ãƒŸãƒƒãƒˆãƒ•ãƒ­ãƒ¼

### 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ–ãƒ©ãƒ³ãƒçµŒç”±ï¼‰

```
worktreeã§ç·¨é›† â†’ ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«ã‚³ãƒŸãƒƒãƒˆ â†’ mainã«ãƒãƒ¼ã‚¸
```

```bash
# ç¾åœ¨ã®ãƒ–ãƒ©ãƒ³ãƒã‚’ç¢ºèª
git branch
# * session/session-XXXX

# ã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ã‚’ã‚³ãƒŸãƒƒãƒˆ
git add code/brainbase/
git commit -m "feat: æ©Ÿèƒ½è¿½åŠ "

# ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–æ™‚ã«mainã«ãƒãƒ¼ã‚¸
```

### 2. æ­£æœ¬ãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆmainç›´æ¥ã‚³ãƒŸãƒƒãƒˆï¼‰

```
worktreeã§ç·¨é›†ï¼ˆã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯çµŒç”±ï¼‰â†’ mainã§ç›´æ¥ã‚³ãƒŸãƒƒãƒˆ
```

```bash
# æ­£æœ¬ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ï¼ˆã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯çµŒç”±ã§è‡ªå‹•çš„ã«æ­£æœ¬ã‚’ç·¨é›†ï¼‰
vim _codex/projects/salestailor/project.md
vim .claude/skills/new-skill/SKILL.md

# mainã«ç›´æ¥ã‚³ãƒŸãƒƒãƒˆ
cd /Users/ksato/workspace
git add _codex/ .claude/
git commit -m "docs: ãƒŠãƒ¬ãƒƒã‚¸è¿½åŠ "
```

---

## 8.5 /merge ã‚³ãƒãƒ³ãƒ‰ã®å‹•ä½œ

ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†æ™‚ã® `/merge` ã‚³ãƒãƒ³ãƒ‰ã¯ä»¥ä¸‹ã‚’å®Ÿè¡Œï¼š

1. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ–ãƒ©ãƒ³ãƒã®å¤‰æ›´ç¢ºèª**
   - ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ã®å¤‰æ›´ãŒã‚ã‚Œã°ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«ã‚³ãƒŸãƒƒãƒˆ

2. **æ­£æœ¬ã®å¤‰æ›´ç¢ºèª**
   - æ­£æœ¬ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã®å¤‰æ›´ãŒã‚ã‚Œã°mainã«ç›´æ¥ã‚³ãƒŸãƒƒãƒˆ
   - ã€Œæ­£æœ¬ã®å¤‰æ›´ã‚’mainã«ã‚³ãƒŸãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿã€ã¨ç¢ºèª

3. **ãƒãƒ¼ã‚¸å®Ÿè¡Œ**
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ–ãƒ©ãƒ³ãƒã‚’mainã«ãƒãƒ¼ã‚¸

---

## 8.6 Worktreeä½œæˆæ™‚ã®ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—

worktreeä½œæˆæ™‚ã«è‡ªå‹•å®Ÿè¡Œï¼š

```bash
# worktreeä½œæˆ
git worktree add /Users/ksato/workspace/shared/.worktrees/session-xxx-brainbase -b session/session-xxx

# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ä½œæˆ
cd /Users/ksato/workspace/shared/.worktrees/session-xxx-brainbase
rm -rf _codex _tasks _inbox _schedules _ops .claude config.yml
ln -s /Users/ksato/workspace/shared/_codex _codex
ln -s /Users/ksato/workspace/shared/_tasks _tasks
ln -s /Users/ksato/workspace/shared/_inbox _inbox
ln -s /Users/ksato/workspace/shared/_schedules _schedules
ln -s /Users/ksato/workspace/shared/_ops _ops
ln -s /Users/ksato/workspace/shared/.claude .claude
ln -s /Users/ksato/workspace/shared/config.yml config.yml
```

---

## 8.7 ãƒ«ãƒ¼ãƒ«ã¾ã¨ã‚

| çŠ¶æ³ | ç·¨é›†å ´æ‰€ | ã‚³ãƒŸãƒƒãƒˆå…ˆ |
|-----|---------|------------|
| Skillsè¿½åŠ ãƒ»æ›´æ–° | worktreeå†…ï¼ˆã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯çµŒç”±ï¼‰ | mainç›´æ¥ |
| ã‚¿ã‚¹ã‚¯æ›´æ–° | worktreeå†…ï¼ˆã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯çµŒç”±ï¼‰ | mainç›´æ¥ |
| ãƒŠãƒ¬ãƒƒã‚¸è¿½åŠ  | worktreeå†…ï¼ˆã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯çµŒç”±ï¼‰ | mainç›´æ¥ |
| ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ | worktreeå†…ï¼ˆå®Ÿãƒ•ã‚¡ã‚¤ãƒ«ï¼‰ | ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ–ãƒ©ãƒ³ãƒ |
| è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«å¤‰æ›´ | worktreeå†…ï¼ˆã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯çµŒç”±ï¼‰ | mainç›´æ¥ |

---

## 8.8 ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ã®åˆ¤æ–­ãƒ•ãƒ­ãƒ¼

æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã™ã‚‹éš›ã€**ã©ã“ã«é…ç½®ã™ã¹ãã‹**ã‚’åˆ¤æ–­ã™ã‚‹ãƒ•ãƒ­ãƒ¼ãƒãƒ£ãƒ¼ãƒˆï¼š

### ã‚¹ãƒ†ãƒƒãƒ—1: ãƒ•ã‚¡ã‚¤ãƒ«ã®æ€§è³ªã‚’ç¢ºèª

**è³ªå•**: ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯èª°ãŒã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‹ï¼Ÿ

- **ä½è—¤ã®ã¿** â†’ `_codex/` ã¸é€²ã‚€
- **GMãƒ»é–¢ä¿‚è€…ã‚‚** â†’ ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒã‚¸ãƒˆãƒªã¸é€²ã‚€

---

### ã‚¹ãƒ†ãƒƒãƒ—2: _codex/ ã«ç½®ãå ´åˆ

`_codex/` ã¯**é‹ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®æ­£æœ¬**ã§ã‚ã‚Šã€ä»¥ä¸‹ã«è©²å½“ã™ã‚‹å ´åˆã®ã¿ä½¿ç”¨ï¼š

**âœ… _codex/ ã«ç½®ãã¹ãã‚‚ã®:**
- æˆ¦ç•¥ãƒ»æ–¹é‡ï¼ˆ01_strategy.mdï¼‰
- ä½“åˆ¶å›³ãƒ»RACIå®šç¾©
- KPIå®šç¾©ï¼ˆæ•°å€¤ç›®æ¨™ã®å®šç¾©ï¼‰
- æ„æ€æ±ºå®šãƒ­ã‚°
- é¡§å®¢æƒ…å ±ï¼ˆæ©Ÿå¯†å«ã‚€ï¼‰
- ç¤¾å†…å°‚ç”¨ã®é‹ç”¨ãƒ«ãƒ¼ãƒ«

**âŒ _codex/ ã«ç½®ã‹ãªã„ã‚‚ã®:**
- GMãƒ»ãƒ¡ãƒ³ãƒãƒ¼ã¨å…±æœ‰ã™ã‚‹è³‡æ–™
- å¤–éƒ¨å…¬é–‹ã™ã‚‹è³‡æ–™ï¼ˆã‚¤ãƒ™ãƒ³ãƒˆç™»å£‡ã€ãƒ–ãƒ­ã‚°è¨˜äº‹ç­‰ï¼‰
- é¡§å®¢å‘ã‘ç´å“ç‰©
- ãƒãƒ¼ã‚±ãƒ†ã‚£ãƒ³ã‚°è³‡æ–™

---

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒã‚¸ãƒˆãƒªã«ç½®ãå ´åˆ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒã‚¸ãƒˆãƒªï¼ˆä¾‹: `baao/`, `salestailor/`ï¼‰ã®é…ç½®å…ˆï¼š

| ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | ç”¨é€” | ä¾‹ |
|-------------|------|-----|
| `docs/` | GMãƒ»é–¢ä¿‚è€…ã¨å…±æœ‰ã™ã‚‹è³‡æ–™ | ã‚¤ãƒ™ãƒ³ãƒˆè³‡æ–™ã€ææ¡ˆæ›¸ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã€FAQ |
| `app/` | ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ¼ãƒ‰ | ã‚½ãƒ¼ã‚¹ã‚³ãƒ¼ãƒ‰ã€ãƒ†ã‚¹ãƒˆ |
| `meetings/` | è­°äº‹éŒ² | ä¼šè­°ãƒ¡ãƒ¢ã€ãƒˆãƒ©ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ |
| `drive/` | å…±æœ‰ãƒ‰ãƒ©ã‚¤ãƒ–ï¼ˆã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ï¼‰ | å¥‘ç´„æ›¸ã€ç´å“ç‰©ã€é¡§å®¢è³‡æ–™ |

**åˆ¤æ–­åŸºæº–:**

```
ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯...
â”œâ”€ ã‚³ãƒ¼ãƒ‰ã‹ï¼Ÿ â†’ app/
â”œâ”€ ä¼šè­°ã®è¨˜éŒ²ã‹ï¼Ÿ â†’ meetings/
â”œâ”€ GMãƒ»é–¢ä¿‚è€…ã¨å…±æœ‰ã™ã‚‹ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã‹ï¼Ÿ â†’ docs/
â””â”€ ãƒ•ã‚¡ã‚¤ãƒ«ãã®ã‚‚ã®ã‚’å…±æœ‰ã™ã‚‹ã‹ï¼Ÿ â†’ drive/
```

---

## 8.9 ã‚ˆãã‚ã‚‹é–“é•ã„ã¨ä¿®æ­£æ–¹æ³•

### âŒ é–“é•ã„1: ã‚¤ãƒ™ãƒ³ãƒˆè³‡æ–™ã‚’ _codex/ ã«ç½®ã

**é–“é•ã£ãŸé…ç½®:**
```
_codex/projects/baao/events/2025-12-21_ai-dojo/
```

**æ­£ã—ã„é…ç½®:**
```
baao/docs/events/2025-12-21_ai-dojo/
```

**ç†ç”±:**
- ã‚¤ãƒ™ãƒ³ãƒˆè³‡æ–™ = å¤–éƒ¨å…¬é–‹ãƒ»GMå…±æœ‰
- `_codex/` = ä½è—¤ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹é‹ç”¨ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

---

### âŒ é–“é•ã„2: KPIå®Ÿç¸¾ã‚’ _codex/ ã«ç½®ã

**é–“é•ã£ãŸé…ç½®:**
```
_codex/projects/salestailor/kpi_results.csv
```

**æ­£ã—ã„é…ç½®:**
```
Airtableï¼ˆå®Ÿç¸¾ãƒˆãƒ©ãƒƒã‚­ãƒ³ã‚°ï¼‰
ã¾ãŸã¯ salestailor/drive/reports/
```

**ç†ç”±:**
- `_codex/` = KPI**å®šç¾©**ã®ã¿
- KPI**å®Ÿç¸¾** = Airtableã¾ãŸã¯å…±æœ‰ãƒ‰ãƒ©ã‚¤ãƒ–ã§ç®¡ç†

---

### âŒ é–“é•ã„3: ã‚³ãƒ¼ãƒ‰ã‚’ _codex/ ã«ç½®ã

**é–“é•ã£ãŸé…ç½®:**
```
_codex/projects/baao/scripts/export.js
```

**æ­£ã—ã„é…ç½®:**
```
baao/app/scripts/export.js
```

**ç†ç”±:**
- ã‚³ãƒ¼ãƒ‰ = ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒªãƒã‚¸ãƒˆãƒªã® `app/` ã«é…ç½®
- `_codex/` = ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã®ã¿

---

## 8.10 ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆå‰ã«ä»¥ä¸‹ã‚’ç¢ºèªï¼š

- [ ] ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯**ä½è—¤ã®ã¿**ãŒã‚¢ã‚¯ã‚»ã‚¹ã™ã‚‹ã‹ï¼Ÿ â†’ YES ãªã‚‰ `_codex/`
- [ ] ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯**GMãƒ»é–¢ä¿‚è€…ã¨å…±æœ‰**ã™ã‚‹ã‹ï¼Ÿ â†’ YES ãªã‚‰ `<project>/docs/`
- [ ] ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯**ã‚³ãƒ¼ãƒ‰**ã‹ï¼Ÿ â†’ YES ãªã‚‰ `<project>/app/`
- [ ] ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯**ä¼šè­°è¨˜éŒ²**ã‹ï¼Ÿ â†’ YES ãªã‚‰ `<project>/meetings/`
- [ ] ã“ã®ãƒ•ã‚¡ã‚¤ãƒ«ã¯**å…±æœ‰ãƒ‰ãƒ©ã‚¤ãƒ–ã§ç®¡ç†**ã™ã‚‹ã‹ï¼Ÿ â†’ YES ãªã‚‰ `<project>/drive/`

**è¿·ã£ãŸã‚‰**: GMãƒ»é–¢ä¿‚è€…ãŒè¦‹ã‚‹å¯èƒ½æ€§ãŒã‚ã‚‹ãªã‚‰ã€`<project>/docs/` ã«ç½®ã

---

## 8.11 ã‚ˆãã‚ã‚‹è³ªå•

### Q: ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ–ãƒ©ãƒ³ãƒã§æ­£æœ¬ã‚’ç·¨é›†ã—ãŸã‚‰ã©ã†ãªã‚‹ï¼Ÿ

A: ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯æ–¹å¼ã§ã¯ã€æ­£æœ¬ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã¯worktreeã«ã‚³ãƒ”ãƒ¼ã•ã‚Œãªã„ãŸã‚ã€ã€Œã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ–ãƒ©ãƒ³ãƒã§æ­£æœ¬ã‚’ç·¨é›†ã€ã¨ã„ã†çŠ¶æ³ã¯ç™ºç”Ÿã—ã¾ã›ã‚“ã€‚æ­£æœ¬ã®ç·¨é›†ã¯å¸¸ã«mainã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç›´æ¥ç·¨é›†ã™ã‚‹ã“ã¨ã«ãªã‚Šã¾ã™ã€‚

### Q: æ­£æœ¬ã®å¤‰æ›´ã‚’ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ–ãƒ©ãƒ³ãƒã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ãŸã„å ´åˆã¯ï¼Ÿ

A: æ­£æœ¬ã®å¤‰æ›´ã¯å³åº§ã«åæ˜ ã•ã‚Œã‚‹ã¹ããƒŠãƒ¬ãƒƒã‚¸ãªã®ã§ã€é€šå¸¸ã¯mainç›´æ¥ã‚³ãƒŸãƒƒãƒˆã§å•é¡Œã‚ã‚Šã¾ã›ã‚“ã€‚ãƒ¬ãƒ“ãƒ¥ãƒ¼ãŒå¿…è¦ãªå¤§ããªå¤‰æ›´ã®å ´åˆã¯ã€ä¸€æ™‚çš„ã«ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ã‚’è§£é™¤ã—ã¦å®Ÿãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ç·¨é›†ã—ã€ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ–ãƒ©ãƒ³ãƒã§ã‚³ãƒŸãƒƒãƒˆâ†’ãƒãƒ¼ã‚¸ã®æµã‚Œã‚‚å¯èƒ½ã§ã™ã€‚

### Q: ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã¯ç™ºç”Ÿã™ã‚‹ï¼Ÿ

A: æ­£æœ¬ãƒ•ã‚¡ã‚¤ãƒ«ã¯å¸¸ã«mainã«ç›´æ¥ã‚³ãƒŸãƒƒãƒˆã•ã‚Œã‚‹ãŸã‚ã€ãƒ–ãƒ©ãƒ³ãƒé–“ã®ã‚³ãƒ³ãƒ•ãƒªã‚¯ãƒˆã¯ç™ºç”Ÿã—ã¾ã›ã‚“ã€‚ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ã®ã¿ãŒã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ–ãƒ©ãƒ³ãƒçµŒç”±ã¨ãªã‚Šã¾ã™ã€‚

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
æ–°è¦ãƒ•ã‚¡ã‚¤ãƒ«ä½œæˆ â†’ ã€Œä½è—¤ã®ã¿ã‚¢ã‚¯ã‚»ã‚¹ï¼ŸGMå…±æœ‰ï¼Ÿã€
æ­£æœ¬ãƒ•ã‚¡ã‚¤ãƒ«ç·¨é›† â†’ ã€Œã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯çµŒç”±ã§è‡ªå‹•çš„ã«mainã€
ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã‚³ãƒ¼ãƒ‰ç·¨é›† â†’ ã€Œã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ–ãƒ©ãƒ³ãƒã«ã‚³ãƒŸãƒƒãƒˆã€
```

---

# Â§ 9. CI/CDèªè¨¼ï¼ˆClaude Codeï¼‰

> **å‡ºå…¸**: code-cicd-auth (setup-tokenæ´»ç”¨)

## 9.1 èªè¨¼æ–¹å¼ã®æ¯”è¼ƒ

| æ–¹å¼ | æœ‰åŠ¹æœŸé™ | ã‚³ã‚¹ãƒˆ | ç”¨é€” |
|------|---------|--------|------|
| `/login`ï¼ˆé€šå¸¸OAuthï¼‰ | ç´„2-3æ™‚é–“ | Maxãƒ—ãƒ©ãƒ³å†… | å¯¾è©±çš„é–‹ç™º |
| `setup-token` | 1å¹´ | Maxãƒ—ãƒ©ãƒ³å†… | CI/CDãƒ»è‡ªå‹•åŒ– |
| `ANTHROPIC_API_KEY` | ç„¡æœŸé™ | å¾“é‡èª²é‡‘ | å¤§é‡å‡¦ç†ãƒ»ãƒãƒ¼ãƒ åˆ©ç”¨ |

---

## 9.2 setup-tokenï¼ˆæ¨å¥¨ï¼‰

### ç”Ÿæˆæ–¹æ³•

```bash
# ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§å¯¾è©±çš„ã«å®Ÿè¡Œï¼ˆ1å›ã®ã¿ï¼‰
claude setup-token
```

å‡ºåŠ›ä¾‹ï¼š
```
âœ“ Long-lived authentication token created successfully!

Your OAuth token (valid for 1 year):
sk-ant-oat01-xxxxx...

Store this token securely. You won't be able to see it again.
Use this token by setting: export CLAUDE_CODE_OAUTH_TOKEN=<token>
```

### ç‰¹å¾´

- **1å¹´é–“æœ‰åŠ¹** - å¹´1å›ã®å†ç”Ÿæˆã§é‹ç”¨å¯èƒ½
- **Maxãƒ—ãƒ©ãƒ³ç¯„å›²å†…** - è¿½åŠ ã®å¾“é‡èª²é‡‘ãªã—
- **å˜ä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘** - å€‹äººãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆãƒ»å°‘äººæ•°ãƒãƒ¼ãƒ å‘ã‘

---

## 9.3 GitHub Actionsã§ã®è¨­å®š

### Step 1: Secretsã«è¿½åŠ 

```
Settings â†’ Secrets and variables â†’ Actions â†’ New repository secret

Name: CLAUDE_CODE_OAUTH_TOKEN
Value: sk-ant-oat01-xxxxx...ï¼ˆsetup-tokenã§ç”Ÿæˆã—ãŸå€¤ï¼‰
```

### Step 2: ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼è¨­å®š

```yaml
# .github/workflows/example.yml
name: Claude Code Job
on:
  workflow_dispatch:

jobs:
  run-claude:
    runs-on: [self-hosted, local]
    steps:
      - uses: actions/checkout@v4

      - name: Setup Claude Code environment
        run: |
          mkdir -p ~/.claude
          echo '{"hasCompletedOnboarding": true}' > ~/.claude.json

      - name: Build prompt
        run: |
          cat > /tmp/prompt.txt << 'EOF'
          ã‚ãªãŸã®ã‚¿ã‚¹ã‚¯å†…å®¹ã‚’ã“ã“ã«è¨˜è¿°
          è¤‡æ•°è¡Œã®ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã‚‚å¯èƒ½
          EOF

      - name: Run Claude Code
        env:
          CLAUDE_CODE_OAUTH_TOKEN: ${{ secrets.CLAUDE_CODE_OAUTH_TOKEN }}
        run: |
          cat /tmp/prompt.txt | claude --print > /tmp/result.txt 2>&1
          cat /tmp/result.txt
```

### ç¨¼åƒä¾‹

ä»¥ä¸‹ã®ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ã§å®Ÿç¸¾ã‚ã‚Šï¼š
- `.github/workflows/task-triage.yml` - é€±æ¬¡ã‚¿ã‚¹ã‚¯æ£šå¸ã—
- `.github/workflows/mana-self-improve.yml` - manaå¿œç­”å“è³ªã®è‡ªå‹•æ”¹å–„

### Step 3: Onboardingè¨­å®šï¼ˆåˆå›ã®ã¿ï¼‰

ã‚³ãƒ³ãƒ†ãƒŠ/æ–°ç’°å¢ƒã§ã¯ `~/.claude.json` ãŒå¿…è¦ï¼š

```bash
mkdir -p ~/.claude
echo '{"hasCompletedOnboarding": true}' > ~/.claude.json
```

---

## 9.4 ã‚»ãƒ«ãƒ•ãƒ›ã‚¹ãƒˆãƒ©ãƒ³ãƒŠãƒ¼ã§ã®åˆ©ç”¨

### ç’°å¢ƒå¤‰æ•°è¨­å®š

```bash
# .bashrc ã¾ãŸã¯ .zshrc
export CLAUDE_CODE_OAUTH_TOKEN="sk-ant-oat01-xxxxx..."
```

### headlessãƒ¢ãƒ¼ãƒ‰ã§ã®å®Ÿè¡Œ

```bash
# ã‚·ãƒ³ãƒ—ãƒ«ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆç‰¹æ®Šæ–‡å­—ãªã—ï¼‰
claude -p "ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆ" --print

# è¤‡é›‘ãªãƒ—ãƒ­ãƒ³ãƒ—ãƒˆï¼ˆæ¨å¥¨ï¼šstdinçµŒç”±ï¼‰
cat prompt.txt | claude --print

# ãƒ„ãƒ¼ãƒ«ã‚’åˆ¶é™ã—ã¦å®Ÿè¡Œ
claude -p "ã‚³ãƒ¼ãƒ‰ãƒ¬ãƒ“ãƒ¥ãƒ¼ã—ã¦" --allowedTools "Read,Glob,Grep" --print
```

**é‡è¦**: ã‚·ã‚§ãƒ«ç‰¹æ®Šæ–‡å­—ï¼ˆ`$`, `\``, `"`, æ”¹è¡Œç­‰ï¼‰ã‚’å«ã‚€ãƒ—ãƒ­ãƒ³ãƒ—ãƒˆã¯ `claude -p "$PROMPT"` ã§å¤±æ•—ã—ã¾ã™ã€‚
å¿…ãš **stdinãƒ‘ã‚¤ãƒ—** (`cat prompt.txt | claude --print`) ã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

---

## 9.5 ãƒˆãƒ¼ã‚¯ãƒ³ç®¡ç†

### æœ‰åŠ¹æœŸé™ã®ç¢ºèª

Keychainã«ä¿å­˜ã•ã‚ŒãŸãƒˆãƒ¼ã‚¯ãƒ³æƒ…å ±ã‚’ç¢ºèªï¼š

```bash
# macOS
security find-generic-password -s "Claude Code-credentials" -w | \
  python3 -c "import sys,json,datetime; \
  d=json.loads(sys.stdin.read()); \
  exp=datetime.datetime.fromtimestamp(d['claudeAiOauth']['expiresAt']/1000); \
  print(f'æœ‰åŠ¹æœŸé™: {exp}')"
```

### æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚°

- **setup-token**ã§ç”Ÿæˆã—ãŸãƒˆãƒ¼ã‚¯ãƒ³ â†’ 1å¹´å¾Œã«å†ç”Ÿæˆ
- **é€šå¸¸OAuth**ï¼ˆ/loginï¼‰ â†’ 2-3æ™‚é–“ã§æœŸé™åˆ‡ã‚Œï¼ˆè‡ªå‹•æ›´æ–°ã‚ã‚Šï¼‰

### ãƒˆãƒ¼ã‚¯ãƒ³å¤±åŠ¹æ™‚

```bash
# æ–°ã—ã„ãƒˆãƒ¼ã‚¯ãƒ³ã‚’ç”Ÿæˆ
claude setup-token

# GitHub Secretsã‚’æ›´æ–°
# Settings â†’ Secrets â†’ CLAUDE_CODE_OAUTH_TOKEN ã‚’ç·¨é›†
```

---

## 9.6 æ³¨æ„äº‹é …

### åˆ¶é™

- **å˜ä¸€ãƒ¦ãƒ¼ã‚¶ãƒ¼å‘ã‘** - Maxãƒ—ãƒ©ãƒ³ã¯å€‹äººåˆ©ç”¨æƒ³å®š
- **è¤‡æ•°äººãƒãƒ¼ãƒ ** - APIã‚­ãƒ¼ï¼ˆå¾“é‡èª²é‡‘ï¼‰ã‚’æ¨å¥¨
- **å¤§é‡å‡¦ç†** - ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚ã‚Šã€APIã‚­ãƒ¼æ¨å¥¨

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£

- ãƒˆãƒ¼ã‚¯ãƒ³ã¯**ä¸€åº¦ã—ã‹è¡¨ç¤ºã•ã‚Œãªã„** - å®‰å…¨ã«ä¿ç®¡
- GitHub Secretsã§ç®¡ç† - å¹³æ–‡ã§ã‚³ãƒŸãƒƒãƒˆã—ãªã„
- æ¼æ´©æ™‚ã¯å³åº§ã«å†ç”Ÿæˆ

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

| å•é¡Œ | åŸå›  | å¯¾ç­– |
|------|------|------|
| `OAuth token has expired` | é€šå¸¸OAuthã®æœŸé™åˆ‡ã‚Œ | `setup-token`ã§é•·æœŸãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆ |
| onboardingç”»é¢ãŒå‡ºã‚‹ | `~/.claude.json`ãŒãªã„ | `hasCompletedOnboarding: true`ã‚’è¨­å®š |
| `authentication_error` | ãƒˆãƒ¼ã‚¯ãƒ³ç„¡åŠ¹ | `setup-token`ã§å†ç”Ÿæˆ |

**æ€è€ƒãƒ‘ã‚¿ãƒ¼ãƒ³**:
```
CI/CDæ§‹ç¯‰ â†’ ã€Œsetup-tokenã§1å¹´ãƒˆãƒ¼ã‚¯ãƒ³ç”Ÿæˆã€
GitHub Secretsè¨­å®š â†’ ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ä½œæˆ
èªè¨¼ã‚¨ãƒ©ãƒ¼ â†’ setup-tokenå†ç”Ÿæˆ
```

---

# Version History

| ãƒãƒ¼ã‚¸ãƒ§ãƒ³ | æ—¥ä»˜ | å¤‰æ›´å†…å®¹ |
|----------|------|---------|
| v4.0 | 2025-12-31 | 11 Skillsçµ±åˆç‰ˆï¼ˆ+ branch-worktree-rules + code-cicd-authï¼‰ã€Â§ 8ã¨Â§ 9è¿½åŠ  |
| v3.0 | 2025-12-30 | 9 Skillsçµ±åˆç‰ˆ |
| v2.0 | 2025-12-30 | 7 Skillsçµ±åˆç‰ˆä½œæˆï¼ˆclaude-code-patterns + brainbase-ops-safety + brainbase-ui-launchd-gotchas + brainbase-ui-version + github-actions-management + worktree-dev-server + env-managementï¼‰ |
| v1.0 | 2025-12-21 | å„Skillå€‹åˆ¥ã«ä½œæˆ |

---

**æœ€çµ‚æ›´æ–°**: 2025-12-31
**ä½œæˆè€…**: Claude Code (Phase 5.3)
**çµ±åˆSkills**: 11å€‹ï¼ˆclaude-code-patterns 286è¡Œ + brainbase-ops-safety 304è¡Œ + brainbase-ui-launchd-gotchas 148è¡Œ + brainbase-ui-version 139è¡Œ + github-actions-management 53è¡Œ + worktree-dev-server 60è¡Œ + env-management 357è¡Œ + branch-worktree-rules 320è¡Œ + code-cicd-auth 200è¡Œï¼‰ = ç´„2,050è¡Œ âœ… OPTIMAL
