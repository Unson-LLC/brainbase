# brainbase 運用ダッシュボード - ワイヤーフレーム仕様

**作成日**: 2025-12-31
**対象**: brainbase監視ダッシュボード（Mana Dashboard統合）
**目的**: 朝5分で全プロジェクトの健全性を把握し、今日すべきことを判断する

---

## 1. 全体レイアウト

### グリッドシステム
- **コンテナ最大幅**: 1312px（n8n型）
- **カラム**: 12カラムグリッド
- **ガター**: 16px（モバイル）、24px（タブレット）、32px（デスクトップ）
- **レスポンシブブレイクポイント**:
  - `sm`: 640px
  - `md`: 810px
  - `lg`: 1200px
  - `xl`: 1440px

### レイアウト構造（縦スクロール）

```
┌─────────────────────────────────────────┐
│ Header (固定)                            │  80px
├─────────────────────────────────────────┤
│ Section 1: 健全性ゲージ (4つ)            │  200px
├─────────────────────────────────────────┤
│ Section 2: サマリーダッシュボード          │  400px
│  - 左: 主要メトリクス (4つ)              │
│  - 中央: 全体健全性ドーナツ               │
│  - 右: 問題プロジェクトドーナツ (2つ)     │
├─────────────────────────────────────────┤
│ Section 3: プロジェクトカードグリッド      │  600px
│  (4列×3行 = 12プロジェクト)             │
├─────────────────────────────────────────┤
│ Section 4: 健全性ヒートマップ (時系列)    │  300px
│  (上位3プロジェクトの4週間推移)          │
├─────────────────────────────────────────┤
│ Section 5: システムリソースゲージ         │  400px
│  (2行×4列 = 8メトリクス)               │
├─────────────────────────────────────────┤
│ Section 6: トレンドグラフ (3つ)          │  300px
└─────────────────────────────────────────┘
Total: ~2280px (縦スクロール)
```

---

## 2. セクション詳細仕様

### Section 1: 健全性ゲージ（4つ）

**レイアウト**: 4カラムグリッド（等幅）

```
┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐
│   85    │ │   72    │ │   45    │ │   90    │
│  ───    │ │  ───    │ │  ───    │ │  ───    │
│ ╱   ╲   │ │ ╱   ╲   │ │ ╱   ╲   │ │ ╱   ╲   │
│🟢   🟢  │ │🟡   🟡  │ │🔴   🔴  │ │🟢   🟢  │
└─────────┘ └─────────┘ └─────────┘ └─────────┘
brainbase   TechKnight  DialogAI    ZEIMS
```

**コンポーネント**: `GaugeChart`（半円ゲージ）

**データソース**:
```javascript
GET /api/brainbase
→ プロジェクト健全性スコア上位4つを抽出
```

**仕様**:
- **サイズ**: 各ゲージ 160px × 120px
- **スコア範囲**: 0-100
- **色分け**:
  - 🟢 緑（70-100）: `#35a670`
  - 🟡 黄（50-69）: `#ff9b26`
  - 🔴 赤（0-49）: `#ee4f27`
- **アニメーション**: ゲージが0から現在値まで0.8秒でアニメーション
- **インタラクション**: クリック → プロジェクト詳細モーダル

**レスポンシブ**:
- デスクトップ（lg+）: 4列
- タブレット（md）: 2列×2行
- モバイル（sm）: 1列×4行

---

### Section 2: サマリーダッシュボード

**レイアウト**: 3カラム（3:4:5）

```
┌──────────────┬──────────────┬─────────────────────┐
│ 左: 主要     │              │ 右: 問題プロジェクト │
│ メトリクス   │ 中央: 全体   │ ドーナツ×2          │
│ (4つ)        │ ドーナツ     │                     │
│              │              │                     │
│ 🟢 121       │   ┌─────┐   │  ┌────┐  ┌────┐   │
│ タスク total │   │ 68% │   │  │45% │  │72% │   │
│              │   │ ─── │   │  │🔴  │  │🟡  │   │
│ 🔴 8         │   │╱   ╲│   │  └────┘  └────┘   │
│ 期限超過     │   └─────┘   │  DialogAI SalesTail│
│              │              │                     │
│ 🟢 85%       │              │                     │
│ 完了率       │              │                     │
│              │              │                     │
│ 🟡 3         │              │                     │
│ ブロック     │              │                     │
└──────────────┴──────────────┴─────────────────────┘
```

#### 左: 主要メトリクス（4つ）

**コンポーネント**: `MetricCard`

**データ**:
| メトリクス | データソース | 色 |
|-----------|-------------|-----|
| タスク総数 | `tasks.total` | 🟢 緑 |
| 期限超過 | `tasks.overdue` | 🔴 赤 |
| 完了率 | `tasks.completed / tasks.total * 100` | 🟢 緑 |
| ブロック | `tasks.blocked` | 🟡 黄 |

**仕様**:
- **数値フォントサイズ**: 48px（bold）
- **ラベルフォントサイズ**: 14px
- **アイコン**: Lucide icons（`list-todo`, `alert-triangle`, `check-circle`, `ban`）
- **カード背景**: `rgba(255, 255, 255, 0.05)` + backdrop-blur

#### 中央: 全体健全性ドーナツ

**コンポーネント**: `DonutChart`

**データソース**:
```javascript
// 12プロジェクトの平均健全性スコア
const overallScore = projects.reduce((sum, p) => sum + p.healthScore, 0) / projects.length;
```

**仕様**:
- **サイズ**: 280px × 280px
- **中央数値フォントサイズ**: 64px
- **セグメント**:
  - 🟢 緑部分: 健全性スコア（0-100%）
  - ⚫ グレー部分: 残り（100% - スコア）
- **アニメーション**: 円周に沿って0.8秒でアニメーション

#### 右: 問題プロジェクトドーナツ（2つ）

**コンポーネント**: `DonutChart`（小）

**データソース**:
```javascript
// 健全性スコアが最も低い2プロジェクト
const problemProjects = projects.sort((a, b) => a.healthScore - b.healthScore).slice(0, 2);
```

**仕様**:
- **サイズ**: 各 140px × 140px
- **配置**: 縦2列
- **ラベル**: プロジェクト名（下部）
- **色**: スコアに応じて赤/黄

---

### Section 3: プロジェクトカードグリッド

**レイアウト**: 4列×3行（12プロジェクト）

```
┌────────┐ ┌────────┐ ┌────────┐ ┌────────┐
│🟢 85%  │ │🟡 72%  │ │🔴 45%  │ │🟢 90%  │
│brainbase│ │TechKnight│ │DialogAI│ │ ZEIMS  │
│ 2 超過 │ │ 1 超過 │ │ 8 超過 │ │ 0 超過 │
└────────┘ └────────┘ └────────┘ └────────┘
```

**コンポーネント**: `ProjectCard`

**データソース**:
```javascript
GET /api/brainbase
→ 12プロジェクトを健全性スコア順にソート
```

**カード仕様**:
- **サイズ**: 各カード 280px × 120px
- **背景**:
  - デフォルト: `rgba(255, 255, 255, 0.05)`
  - ホバー: `rgba(255, 255, 255, 0.1)` + scale(1.02)
- **構成**:
  - 上部: 健全性スコア（大きく表示、48px）+ 色アイコン
  - 中央: プロジェクト名（18px、bold）
  - 下部: 期限超過件数（14px、赤色で強調）
- **色アイコン**:
  - 🟢 緑円: スコア70-100
  - 🟡 黄円: スコア50-69
  - 🔴 赤円: スコア0-49
- **インタラクション**: クリック → プロジェクト詳細モーダル

**レスポンシブ**:
- デスクトップ（lg+）: 4列
- タブレット（md）: 3列×4行
- モバイル（sm）: 2列×6行

---

### Section 4: 健全性ヒートマップ（時系列）

**レイアウト**: 縦3行（上位3プロジェクトの4週間推移）

```
DialogAI  ████████████░░░░░░░░░░░░░░░░░░
          Week1  Week2  Week3  Week4
          🟢85  🟡75  🟡70  🔴45

SalesTailor ████████████████████░░░░░░░░░░
            Week1  Week2  Week3  Week4
            🟢78  🟢75  🟡68  🟡62

TechKnight  ████████████████████████████████
            Week1  Week2  Week3  Week4
            🟢88  🟢90  🟢88  🟢88
```

**コンポーネント**: `HeatmapRow`

**データソース**:
```javascript
GET /api/dashboard/trends/:projectId
→ 過去4週間の健全性スコア
```

**仕様**:
- **各行の高さ**: 80px
- **バー幅**: 100%（4週間分）
- **色**:
  - 🟢 緑: スコア70-100
  - 🟡 黄: スコア50-69
  - 🔴 赤: スコア0-49
  - ⚪ グレー: データなし
- **ホバー**: 週ごとの詳細ツールチップ表示
  ```
  Week 3
  スコア: 70点
  期限超過: 5件
  ブロッカー: 2件
  ```

**レスポンシブ**:
- 縦スクロール可能
- モバイルでは左右スクロール

---

### Section 5: システムリソースゲージ

**レイアウト**: 2行×4列（8メトリクス）

```
┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐
│  67  │  │  99  │  │  85  │  │ 95.2 │
│ ───  │  │ ───  │  │ ───  │  │ ───  │
│🟡  🟡│  │🔴  🔴│  │🟡  🟡│  │🟢  🟢│
└──────┘  └──────┘  └──────┘  └──────┘
CPU %     MEM %     DISK %    Mana成功率

┌──────┐  ┌──────┐  ┌──────┐  ┌──────┐
│ 55G  │  │ 3.1G │  │  44  │  │  0   │
│ ───  │  │ ───  │  │ ───  │  │ ───  │
│🟡  🟡│  │🟢  🟢│  │🟢  🟢│  │🔴  🔴│
└──────┘  └──────┘  └──────┘  └──────┘
Workspace Worktrees Worktrees Runners
/460G     Total     Active    Online
```

**コンポーネント**: `GaugeChart`（小型）

**データソース**:
| メトリクス | APIパス | 閾値 |
|-----------|---------|------|
| CPU使用率 | `system.cpu.usage` | 🟢<70, 🟡70-89, 🔴≥90 |
| メモリ使用率 | `system.memory.usage` | 🟢<70, 🟡70-89, 🔴≥90 |
| ディスク使用率 | `system.disk.usage` | 🟢<70, 🟡70-84, 🔴≥85 |
| Mana応答成功率 | (算出) | 🟢≥95, 🟡90-94, 🔴<90 |
| Workspace容量 | `storage.workspace.workspace.size` | 表示のみ |
| Worktrees容量 | `storage.workspace.worktrees.size` | 表示のみ |
| Worktrees数 | `worktrees.active` | 表示のみ |
| Runners Online | `github.runners.online` | 🟢≥1, 🔴=0 |

**仕様**:
- **各ゲージサイズ**: 120px × 100px
- **数値フォントサイズ**: 32px
- **ラベルフォントサイズ**: 12px
- **色**: 上記閾値に従う

**レスポンシブ**:
- デスクトップ（lg+）: 4列×2行
- タブレット（md）: 2列×4行
- モバイル（sm）: 1列×8行

---

### Section 6: トレンドグラフ（3つ）

**レイアウト**: 3カラム（等幅）

```
┌─────────────┬─────────────┬─────────────┐
│全体完了率    │期限超過推移  │Mana応答率    │
│100%│        │20│          │100%│        │
│    │   ╱──╲ │15│   ╱╲     │    │  ───── │
│ 85%│  ╱   ╲ │10│  ╱  ╲    │    │  ───── │
│    │ ╱     ─│ 5│ ╱    ╲   │    │  ───── │
│ 70%│╱       │ 0│╱      ─  │    │  ───── │
│    └────────│  └─────────  │    └─────── │
│    4w 3w 2w 1w│ 4w 3w 2w 1w │ 4w 3w 2w 1w │
└─────────────┴─────────────┴─────────────┘
```

**コンポーネント**: `LineChart`（Recharts使用）

**データソース**:
```javascript
GET /api/dashboard/trends
→ 過去4週間のトレンドデータ
```

**グラフ仕様**:
| グラフ | Y軸 | データ | 色 |
|--------|-----|--------|-----|
| 全体完了率 | 0-100% | `(週ごとの完了タスク / 総タスク) * 100` | `#35a670` 緑 |
| 期限超過推移 | 0-最大値 | 週ごとの期限超過タスク数 | `#ee4f27` 赤 |
| Mana応答率 | 0-100% | 週ごとのMana応答成功率 | `#6b21ef` 紫 |

**仕様**:
- **各グラフサイズ**: 400px × 250px
- **線の太さ**: 3px
- **ドット**: 各データポイントに円（半径5px）
- **グリッド**: Y軸に5本のグリッド線
- **ホバー**: ツールチップで詳細値表示
- **アニメーション**: 左から右へ0.8秒でアニメーション

**レスポンシブ**:
- デスクトップ（lg+）: 3列
- タブレット（md）: 1列×3行（縦積み）
- モバイル（sm）: 1列×3行、グラフ高さ200px

---

## 3. コンポーネント一覧

### 新規作成が必要なコンポーネント

| コンポーネント | 用途 | ライブラリ |
|---------------|------|-----------|
| `GaugeChart` | 半円ゲージ（健全性スコア、システムリソース） | Canvas API / SVG |
| `DonutChart` | ドーナツチャート（全体健全性、問題プロジェクト） | Recharts |
| `MetricCard` | 主要メトリクス表示カード | Vanilla JS |
| `ProjectCard` | プロジェクトカード（グリッド用） | Vanilla JS |
| `HeatmapRow` | ヒートマップ行（時系列推移） | Vanilla JS + CSS |
| `LineChart` | 折れ線グラフ（トレンド） | Recharts |

### 既存コンポーネント活用

| コンポーネント | 場所 | 用途 |
|---------------|------|------|
| `BrainbaseService` | `public/modules/domain/brainbase/brainbase-service.js` | API呼び出し |
| `HttpClient` | `public/modules/core/http-client.js` | HTTP通信 |

---

## 4. カラーシステム

### プライマリカラー（健全性スコア）

```javascript
const healthColors = {
  excellent: '#35a670',  // 緑（70-100点）
  warning: '#ff9b26',    // 黄（50-69点）
  danger: '#ee4f27',     // 赤（0-49点）
  neutral: '#6f87a0',    // グレー（データなし）
};
```

### 背景色（ダークテーマ）

```javascript
const backgrounds = {
  primary: '#0e0918',    // メイン背景
  secondary: '#1f192a',  // セクション背景
  card: '#1b1728',       // カード背景
  overlay: 'rgba(255, 255, 255, 0.05)',  // カードオーバーレイ
};
```

### テキストカラー

```javascript
const textColors = {
  primary: '#c4bbd3',    // メインテキスト
  secondary: '#6f87a0',  // サブテキスト
  white: '#ffffff',      // 強調テキスト
};
```

### アクセントカラー

```javascript
const accents = {
  blue: '#6b21ef',       // Manaブランド
  orange: '#ff9b26',     // セカンダリCTA
};
```

---

## 5. インタラクション仕様

### ホバーエフェクト

**プロジェクトカード**:
```javascript
// デフォルト
background: rgba(255, 255, 255, 0.05);
transform: scale(1);

// ホバー時
background: rgba(255, 255, 255, 0.1);
transform: scale(1.02);
transition: all 0.3s ease;
```

**ゲージチャート**:
```javascript
// ホバー時：ツールチップ表示
<div class="tooltip">
  brainbase
  健全性スコア: 85点
  期限超過: 2件
  ブロッカー: 0件
</div>
```

### クリックアクション

**プロジェクトカード / ゲージチャート**:
- クリック → プロジェクト詳細モーダル表示
- モーダル内容:
  - 健全性スコアの内訳
  - 期限超過タスク一覧（最大10件）
  - ブロッカータスク一覧
  - 4週間トレンドグラフ
  - 推奨アクション

**ヒートマップ**:
- 各週のバーにホバー → その週の詳細ツールチップ
- クリック → その週のタスク一覧モーダル

---

## 6. データフロー

### APIエンドポイント

| エンドポイント | 用途 | データ構造 |
|---------------|------|-----------|
| `GET /api/brainbase` | 全監視データ統合 | `{ github, system, storage, tasks, worktrees }` |
| `GET /api/dashboard/trends/:projectId` | プロジェクト別トレンド（Phase 4） | `{ weeks: [{ score, overdue, blocked }] }` |

### データ変換

**健全性スコア計算**（フロントエンド側）:
```javascript
function calculateHealthScore(project) {
  const overdueScore = Math.max(0, 100 - (project.overdue * 10));
  const blockedScore = Math.max(0, 100 - (project.blocked * 15));
  const completionScore = project.completionRate;
  const manaScore = project.manaErrorCount === 0 ? 100 : Math.max(0, 100 - (project.manaErrorCount * 5));

  return Math.round((overdueScore * 0.3 + blockedScore * 0.3 + completionScore * 0.3 + manaScore * 0.1));
}
```

**色判定**:
```javascript
function getHealthColor(score) {
  if (score >= 70) return '#35a670'; // 緑
  if (score >= 50) return '#ff9b26'; // 黄
  return '#ee4f27'; // 赤
}
```

---

## 7. 実装優先順位（Phase分け）

### Phase 1: コアダッシュボード（Week 1）
- ✅ APIエンドポイント準備済み（`/api/brainbase`）
- [ ] Section 1: 健全性ゲージ（4つ）
- [ ] Section 2: サマリーダッシュボード（メトリクス + ドーナツ）
- [ ] Section 3: プロジェクトカードグリッド
- [ ] 基本的なレスポンシブ対応

**成果物**: 朝5分で全プロジェクト把握可能な状態

---

### Phase 2: ヒートマップとシステムリソース（Week 2）
- [ ] Section 4: 健全性ヒートマップ（時系列）
  - データソース: 既存 `/api/brainbase` から過去データを蓄積開始
- [ ] Section 5: システムリソースゲージ
- [ ] プロジェクト詳細モーダル

**成果物**: ボトルネック発見機能の強化

---

### Phase 3: トレンド分析（Week 3）
- [ ] Section 6: トレンドグラフ（3つ）
- [ ] バックエンド: トレンドデータ蓄積（NoCoDB）
- [ ] API: `GET /api/dashboard/trends/:projectId`
- [ ] 日次バッチ Lambda（Phase 4-Bから延期）

**成果物**: 中長期的な兆候把握

---

### Phase 4: ポリッシュ＆最適化（Week 4）
- [ ] アニメーション調整
- [ ] パフォーマンス最適化（will-change）
- [ ] アクセシビリティ改善
- [ ] モバイル UI 最適化
- [ ] ダークテーマ完全対応

---

## 8. 技術スタック

### フロントエンド
- **フレームワーク**: Vanilla JavaScript（既存brainbase-ui構造に準拠）
- **チャートライブラリ**: Recharts（CDN経由）
- **アイコン**: Lucide icons（既存）
- **スタイリング**: CSS（modern-saas-design-patterns適用）

### バックエンド
- **既存API**: `/api/brainbase`（実装済み）
- **新規API**（Phase 3）: `/api/dashboard/trends/:projectId`
- **データ蓄積**（Phase 3）: NoCoDB `Dashboard_Metrics` テーブル

---

## 9. パフォーマンス目標

| 指標 | 目標値 |
|------|--------|
| 初回表示時間（FCP） | <1.5秒 |
| インタラクティブまで（TTI） | <3秒 |
| データ更新（リフレッシュ） | <1秒 |
| アニメーション FPS | 60fps |

### 最適化手法
- ゲージチャート: Canvas API使用（SVGより軽量）
- チャート: Rechartsの遅延読み込み
- 画像: なし（SVG/Canvas のみ）
- will-change: アニメーション要素に適用

---

## 10. アクセシビリティ

- **色コントラスト**: WCAG AA準拠（4.5:1以上）
- **キーボード操作**: Tab/Enter でカード選択可能
- **スクリーンリーダー**: aria-label で各メトリクス説明
- **フォーカスインジケーター**: outline 2px blue

---

## 11. モックアップ参考

**参考画像**: `/path/to/reference-dashboard.png`（ユーザー提供）

**採用要素**:
- ✅ 半円ゲージ（上部＋下部）
- ✅ ドーナツチャート（中央＋右上）
- ✅ コンパクトカードグリッド
- ✅ ヒートマップ（時系列）
- ✅ 折れ線グラフ
- ✅ ダークテーマ

**brainbase独自要素**:
- 健全性スコア（0-100点）
- プロジェクト別メトリクス
- 推奨アクション
- システムリソース監視

---

## 12. 次のステップ

1. **Phase 1実装開始**:
   - `GaugeChart` コンポーネント作成
   - Section 1, 2, 3 実装

2. **デザインレビュー**:
   - Phase 1完了後にユーザーと確認
   - フィードバック反映

3. **Phase 2-4順次実装**:
   - 1週間ごとにレビューとイテレーション

---

最終更新: 2025-12-31
