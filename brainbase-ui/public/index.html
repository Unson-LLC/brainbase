<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>brainbase UI</title>
    <link rel="icon" type="image/png" href="favicon.png">
    <link rel="stylesheet" href="style.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Noto+Sans+JP:wght@400;500;700&display=swap"
        rel="stylesheet">
</head>

<body class="dark-theme">
    <div class="app-container">
        <!-- Left Navigation (Session List) -->
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-header">
                <h3>Sessions</h3>
                <button id="add-session-btn" class="add-session-btn-icon" title="New Session">
                    <i data-lucide="plus"></i>
                </button>
            </div>
            <div class="session-list" id="session-list">
                <!-- Sessions will be loaded dynamically -->
            </div>
            <!-- Footer removed as button moved to header -->
        </nav>

        <!-- Main Content (Console) -->
        <main class="main-content">
            <div class="console-area">
                <div class="console-toolbar">
                    <button id="copy-terminal-btn" class="console-btn" title="ターミナル内容をコピー">
                        <i data-lucide="copy"></i>
                    </button>
                </div>
                <iframe id="terminal-frame" src="about:blank" style="width: 100%; height: 100%; border: none;"></iframe>
                <div id="drop-overlay" class="drop-overlay">
                    <div class="drop-overlay-content">
                        <i data-lucide="upload"></i>
                        <span>ファイルをドロップしてアップロード</span>
                    </div>
                </div>
            </div>
        </main>

        <!-- Right Sidebar (Context: Today's Page) -->
        <aside class="context-sidebar" id="context-sidebar">
            <!-- Focus Section: 最重要タスク1つ -->
            <div class="focus-section" id="focus-section">
                <div class="section-header">
                    <h3><i data-lucide="target"></i> 今日のフォーカス</h3>
                </div>
                <div id="focus-task">
                    <div class="loading">読み込み中...</div>
                </div>
            </div>

            <!-- Timeline Section: 予定+タスク統合 -->
            <div class="timeline-section" id="timeline-section">
                <div class="section-header">
                    <h3><i data-lucide="calendar"></i> タイムライン</h3>
                </div>
                <div id="timeline-list">
                    <div class="loading">読み込み中...</div>
                </div>
            </div>

            <!-- Next Tasks Section: 残りのタスク -->
            <div class="next-tasks-section" id="next-tasks-section">
                <div class="section-header">
                    <h3><i data-lucide="list-todo"></i> 次にやること</h3>
                    <button id="toggle-all-tasks" class="icon-btn" title="全て表示"><i data-lucide="chevron-down"></i></button>
                </div>
                <div id="next-tasks-list">
                    <div class="loading">読み込み中...</div>
                </div>
                <div id="remaining-tasks-toggle" class="remaining-toggle" style="display: none;">
                    <button id="show-more-tasks">他 <span id="remaining-count">0</span> 件を表示</button>
                </div>
            </div>
        </aside>
    </div>

    <footer class="app-footer">
        <div class="footer-controls">
            <button id="focus-btn" class="btn-primary"><i data-lucide="play"></i> フォーカス開始</button>
            <button id="pomodoro-btn" class="btn-secondary"><i data-lucide="timer"></i> ポモドーロ</button>
        </div>
        <div class="footer-actions">
            <button onclick="location.reload()" class="icon-btn"><i data-lucide="refresh-cw"></i></button>
            <button class="icon-btn"><i data-lucide="settings"></i></button>
        </div>
    </footer>

    <!-- Terminal Copy Modal -->
    <div id="copy-terminal-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>ターミナル出力</h3>
                <div class="modal-header-actions">
                    <button id="copy-content-btn" class="btn-primary btn-sm"><i data-lucide="copy"></i> コピー</button>
                    <button class="close-modal-btn"><i data-lucide="x"></i></button>
                </div>
            </div>
            <div class="modal-body">
                <pre id="terminal-content-display" class="terminal-content"></pre>
            </div>
        </div>
    </div>

    <!-- Edit Task Modal -->
    <div id="edit-task-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Task</h3>
                <button class="close-modal-btn"><i data-lucide="x"></i></button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="edit-task-id">
                <div class="form-group">
                    <label>Title</label>
                    <input type="text" id="edit-task-title" class="form-input">
                </div>
                <div class="form-group">
                    <label>Project</label>
                    <select id="edit-task-project" class="form-input">
                        <option value="brainbase">brainbase</option>
                        <option value="unson">unson</option>
                        <option value="tech-knight">tech-knight</option>
                        <option value="salestailor">salestailor</option>
                        <option value="zeims">zeims</option>
                        <option value="baao">baao</option>
                        <option value="ncom">ncom</option>
                        <option value="general">general</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Priority</label>
                    <select id="edit-task-priority" class="form-input">
                        <option value="high">High</option>
                        <option value="medium">Medium</option>
                        <option value="low">Low</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Due Date</label>
                    <input type="date" id="edit-task-due" class="form-input">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-secondary close-modal-btn">Cancel</button>
                <button id="save-task-btn" class="btn-primary">Save Changes</button>
            </div>
        </div>
    </div>

    <script src="app.js?v=fix11"></script>
    <script>
        lucide.createIcons();
    </script>
</body>

</html>
